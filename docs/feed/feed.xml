<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:base="en">
	<title>stinky.blog</title>
	<subtitle>brain of brian. notes about fun things i&#39;m learning</subtitle>
	<link href="https://stinky.blog/feed/feed.xml" rel="self"/>
	<link href="https://stinky.blog/"/>
	<updated>2024-12-26T00:00:00Z</updated>
	<id>https://stinky.blog/</id>
	<author>
		<name>Brian</name>
		<email>brianm88@gmail.com</email>
	</author>
	
	<entry>
		<title>Christmas homelab update</title>
		<link href="https://stinky.blog/blog/christmas-homelab-update/"/>
		<updated>2024-12-26T00:00:00Z</updated>
		<id>https://stinky.blog/blog/christmas-homelab-update/</id>
		<content type="html">&lt;p&gt;Hi blog!  It&#39;s been a minute.  2024 zoomed by, but it was a great year for me.  Landed my dream job, made some progress in the computer science degree, and found some great new friendships.  I wish the same good fortune to anyone reading this.&lt;/p&gt;
&lt;p&gt;The homelab has been rock solid, chugging away for the past year without any hiccups.  Recovered from a week-long power outage after hurricane Helene with no issues.  My most-used services over the past few months have been jellyfin, satisfactory game server, firefly finance, and a VM I use for practicing databases.  I had fun with a remote gaming VM as well, with GPU passthrough and sunlight/moonlight to my hacked Switch.  I&#39;m also still using my guacamole server a decent amount for remoting into everything via web browser.  I should have written posts about some of that stuff!&lt;/p&gt;
&lt;p&gt;But alas, the itch to upgrade has come again.  This time, my goals are simpler:  I just want to &#39;downsize&#39; my 3 nodes into one larger, more efficient, more powerful server.  I had enough fun with the little Intel ARC 310 gpu in Proxmox that I want to incorporate a full-size GPU into this build as well, and start dabbling with LLMs.&lt;/p&gt;
&lt;h2 id=&quot;so-here-s-where-i-was-last-year&quot; tabindex=&quot;-1&quot;&gt;So here&#39;s where I was last year: &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/christmas-homelab-update/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/bthkkEO_Fv-600.avif 600w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/bthkkEO_Fv-600.webp 600w&quot;&gt;&lt;img alt=&quot;Old cluster&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/bthkkEO_Fv-600.jpeg&quot; width=&quot;600&quot; height=&quot;800&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;P330 SFF - i7 8700k, 64gb ddr4, 4tb nvme, 12tb hdd, intel arc 310, 10gbe&lt;br&gt;
P320 Tower - i7 7700k, 64gb ddr4, 4tb nvme, 4tb sata ssd, 4x 12tb hdd, 10gbe&lt;br&gt;
Thinkpad x270 - i7 7200u, 16gb ddr4, 512gb nvme, 5gbe&lt;/p&gt;
&lt;p&gt;The p320 housed the big ZFS pool containing the fileserver and the datastore for Proxmox backup server.  In addition to files and backups, it also ran the satisfactory game server and bittorrent server.&lt;/p&gt;
&lt;p&gt;The p330 ran all my VMs and did GPU passthrough stuff.  It also synced the fileserver and backup server datasets to that spare 12tb drive.&lt;/p&gt;
&lt;p&gt;The x270 ran all the containers -- guacamole, caddy, firefly, tailscale, dyndns, and more.&lt;/p&gt;
&lt;h2 id=&quot;the-upgrade&quot; tabindex=&quot;-1&quot;&gt;The upgrade: &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/christmas-homelab-update/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Downsizing all this stuff requires an upsized chassis, yet my shelf is tiny.  Enter the Racksource 4U shallow depth chassis.  I thought this chassis looked pretty cool, and I was too impatient to wait for the jonsbo n5 to come out.  **I will regret not selecting a chassis with hot swap bays later in this post.&lt;/p&gt;
&lt;p&gt;I also chose to use lots of desktop parts for this build, as the Black Friday sales were great.  Maybe I will swap to ECC ram later, but these parts will work great for this purpose.&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/Cx_F9UG5ZN-800.avif 800w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/Cx_F9UG5ZN-800.webp 800w&quot;&gt;&lt;img alt=&quot;Big pile of parts in boxes&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/Cx_F9UG5ZN-800.jpeg&quot; width=&quot;800&quot; height=&quot;600&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;I went with a 8-core, 16-thread 5700X and 128GB of ddr4 3200mhz.  Grabbed the X570 Taichi for all the nvme slots.&lt;/p&gt;
&lt;p&gt;Also grabbed some Noctua and beQuiet stuff to help my ears.&lt;/p&gt;
&lt;h2 id=&quot;let-s-build-it&quot; tabindex=&quot;-1&quot;&gt;Let&#39;s build it: &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/christmas-homelab-update/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Here&#39;s what she looks like empty.  You get 3x 120mm fans up front and 2x 60mm fans out back, with a support bar in the middle that you can mount about 3 drives to the underside of.&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/RasNZV5KRV-600.avif 600w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/RasNZV5KRV-600.webp 600w&quot;&gt;&lt;img alt=&quot;Empty case with fans&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/RasNZV5KRV-600.jpeg&quot; width=&quot;600&quot; height=&quot;800&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;I went ahead and ripped all that out and installed the good fans.&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/fGkDK7VAZk-600.avif 600w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/fGkDK7VAZk-600.webp 600w&quot;&gt;&lt;img alt=&quot;Good fans installed&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/fGkDK7VAZk-600.jpeg&quot; width=&quot;600&quot; height=&quot;800&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;Installing the motherboard, PSU, and heatsink went well.  My wife took over and completed some of this part.&lt;/p&gt;
&lt;p&gt;My dog also brought us a rock incase we get super mad and need to smash something:&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/MHXcf7itr8-800.avif 800w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/MHXcf7itr8-800.webp 800w&quot;&gt;&lt;img alt=&quot;Helper brought a rock&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/MHXcf7itr8-800.jpeg&quot; width=&quot;800&quot; height=&quot;600&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;I removed the metal plate covering up the m.2 slots and southbridge stuff.  I installed both 4tb nvme ssds from the Thinkstations here for the ZFS mirror that will store the VMs.  I also installed a 256gb nvme ssd in the 3rd slot for the boot drive.&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/t7kjbYx1Bl-800.avif 800w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/t7kjbYx1Bl-800.webp 800w&quot;&gt;&lt;img alt=&quot;Heatsink, board, psu&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/t7kjbYx1Bl-800.jpeg&quot; width=&quot;800&quot; height=&quot;600&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;h2 id=&quot;installing-drives&quot; tabindex=&quot;-1&quot;&gt;Installing drives: &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/christmas-homelab-update/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Next, I installed the 4x 12tb spinning disks.  **This part sucked.&lt;/p&gt;
&lt;p&gt;The drives go in this little cage here.&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/SINgIToIRh-600.avif 600w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/SINgIToIRh-600.webp 600w&quot;&gt;&lt;img alt=&quot;Drives in cage&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/SINgIToIRh-600.jpeg&quot; width=&quot;600&quot; height=&quot;800&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/kuYKKnYF7n-600.avif 600w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/kuYKKnYF7n-600.webp 600w&quot;&gt;&lt;img alt=&quot;Drives in cage 2&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/kuYKKnYF7n-600.jpeg&quot; width=&quot;600&quot; height=&quot;800&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;**Can you see what&#39;s about to become a huge problem?&lt;/p&gt;
&lt;p&gt;There is absolutely no room between the drive cage and either the fans in front of it or the PSU connectors behind it.&lt;/p&gt;
&lt;p&gt;Here&#39;s what it looks like with no fan installed and no PSU cables connected:&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/hPMnLDVDDJ-600.avif 600w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/hPMnLDVDDJ-600.webp 600w&quot;&gt;&lt;img alt=&quot;No space&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/hPMnLDVDDJ-600.jpeg&quot; width=&quot;600&quot; height=&quot;800&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/wsZyVW5eV_-600.avif 600w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/wsZyVW5eV_-600.webp 600w&quot;&gt;&lt;img alt=&quot;No space 2&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/wsZyVW5eV_-600.jpeg&quot; width=&quot;600&quot; height=&quot;800&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;You&#39;ll need a super long screwdriver to reach screws at the bottom of the drive cage:&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/XW9VnoI2EN-600.avif 600w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/XW9VnoI2EN-600.webp 600w&quot;&gt;&lt;img alt=&quot;No space 3&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/XW9VnoI2EN-600.jpeg&quot; width=&quot;600&quot; height=&quot;800&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;After getting it all installed and working, I had one drive in the ZFS pool showing as dead or dying.&lt;/p&gt;
&lt;p&gt;Upon ripping it all back apart, I realized that the sata cable &lt;em&gt;&lt;strong&gt;at the bottom of the whole drive stack&lt;/strong&gt;&lt;/em&gt; had been yanked out!&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/P2iFgdZAXD-600.avif 600w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/P2iFgdZAXD-600.webp 600w&quot;&gt;&lt;img alt=&quot;Loose cable&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/P2iFgdZAXD-600.jpeg&quot; width=&quot;600&quot; height=&quot;799&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;That was a huge pain the butt to reinstall.  Next time, I will remember to wait for the jonsbo N5 to come out.&lt;/p&gt;
&lt;p&gt;I went ahead and threw my old Nvidia 1070Ti in here for now.  At this point, I only had to wait on a $1.29 piece of stamped metal to get here from China -- a full height bracket for my 10 gig SFP nic:&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/ZsCy601bD1-800.avif 800w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/ZsCy601bD1-800.webp 800w&quot;&gt;&lt;img alt=&quot;Finished&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/ZsCy601bD1-800.jpeg&quot; width=&quot;800&quot; height=&quot;570&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;Never bolt the chassis cover back on without testing it first!  Feast your eyes on the server RGB:&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/ruwmpoYTQA-600.avif 600w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/ruwmpoYTQA-600.webp 600w&quot;&gt;&lt;img alt=&quot;RGB&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/ruwmpoYTQA-600.jpeg&quot; width=&quot;600&quot; height=&quot;800&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;h2 id=&quot;teach-new-server-about-its-ancestors&quot; tabindex=&quot;-1&quot;&gt;Teach new server about its ancestors &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/christmas-homelab-update/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;I started learning all of this server stuff on a bunch of e-waste.  I upgraded from pure trash to semi trash, collecting Thinkpads and Thinkstations along the way.  I wanted to keep the Thinkspirit with this build, so I slapped a badge on the new server:&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/DmXRFTAG2f-800.avif 800w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/DmXRFTAG2f-800.webp 800w&quot;&gt;&lt;img alt=&quot;Stickers and emblems&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/DmXRFTAG2f-800.jpeg&quot; width=&quot;800&quot; height=&quot;600&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Now it&#39;s finished!&lt;/strong&gt;  I kept the x270 around for periodic backups and other random things --&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/fzRVrOOzwK-600.avif 600w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/fzRVrOOzwK-600.webp 600w&quot;&gt;&lt;img alt=&quot;New setup&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/fzRVrOOzwK-600.jpeg&quot; width=&quot;600&quot; height=&quot;800&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;8c16t AMD 5700X
128gb ddr4 3200
256gb nvme boot drive
2x 4tb nvme ZFS mirror VM storage
4x 12tb hdd ZFS pool
4tb sata ssd L2Arc / slog
nvidia 1070Ti&lt;/p&gt;
&lt;p&gt;Not a bad build!  I think I will get plenty of learnings out of this machine over the next couple of years.&lt;/p&gt;
&lt;p&gt;Now I&#39;m off to go try and break it.&lt;/p&gt;
&lt;p&gt;Happy homelabbing friends!&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/1oJKjK-X0I-800.avif 800w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/1oJKjK-X0I-800.webp 800w&quot;&gt;&lt;img alt=&quot;Cosplaying as a Sysadmin&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/1oJKjK-X0I-800.jpeg&quot; width=&quot;800&quot; height=&quot;600&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>Opnsense High(er) Availability</title>
		<link href="https://stinky.blog/blog/opnsense/opnsense-high(er)-availablility/"/>
		<updated>2024-07-03T00:00:00Z</updated>
		<id>https://stinky.blog/blog/opnsense/opnsense-high(er)-availablility/</id>
		<content type="html">&lt;h2 id=&quot;why-virtualize-my-router&quot; tabindex=&quot;-1&quot;&gt;Why virtualize my router? &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/opnsense/opnsense-high(er)-availablility/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;I ditched my Asus w/merlin router more than a year ago and started using an opnsense VM on one of my Proxmox hosts.  It has been pretty awesome!  It comes packed with an insane amount of features that really come in handy for the homelab.  Mine has been trucking along in a little 4-cpu 4GB VM doing packet inspection with Zenarmor, caching http with squid proxy (linux/windows updates!), taking zfs snapshots of itself after configuration changes, and so much more.  Now I just use the old Asus routers in access point mode for wifi.&lt;/p&gt;
&lt;h2 id=&quot;the-bad&quot; tabindex=&quot;-1&quot;&gt;The bad &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/opnsense/opnsense-high(er)-availablility/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The only downside to virtualizing the router/firewall is that homelab tinkering can then knock the internet out for everybody else in the house.  Rebooting the proxmox host for updates, moving hardware around, or changing configurations will inconvenience everyone.  It&#39;s all fun and games until the living room TV stops streaming!&lt;/p&gt;
&lt;p&gt;When I originally created the VM, I was using two physical interfaces on that Proxmox host: a 10gbe nic connected to switch for LAN and a 2.5gbe nic with cable modem plugged into it for WAN.  This setup prevented me from being able to migrate the router VM to a different host if I needed to bring that machine down for any reason.&lt;/p&gt;
&lt;h2 id=&quot;fixing-the-bad&quot; tabindex=&quot;-1&quot;&gt;Fixing the bad &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/opnsense/opnsense-high(er)-availablility/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;In a router-on-a-stick configuration, the WAN and LAN virtual interfaces are on separate vlans but share the physical port (or linux bridge in Proxmox), making it super easy to migrate the router VM to any other machine in the cluster.  The Proxmox hosts are connected to the switch via 10 gig sfp dac and the opnsense VM gets replicated to the other hosts every 30 mins, so the switchover between them happens nearly instantly.  It&#39;s so quick that our TVs continue streaming without a hiccup.  I was even able to migrate the VM between hosts in the middle of a speedtest.net run!&lt;/p&gt;
&lt;p&gt;Opnsense has high availability built-in as well, but it is fairly complicated -- requiring multiple VMs with multiple interfaces for each.  Using vlans instead, you can just use the high availability feature built-in to your hypervisor to accomplish this much easier.&lt;/p&gt;
&lt;h2 id=&quot;basic-steps-for-proxmox&quot; tabindex=&quot;-1&quot;&gt;Basic steps for Proxmox &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/opnsense/opnsense-high(er)-availablility/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Plug the cable modem into a managed switch port&lt;/li&gt;
&lt;li&gt;Configure that port as untagged and give it a vlan&lt;/li&gt;
&lt;li&gt;Tag ports used by proxmox hosts with that vlan&lt;/li&gt;
&lt;li&gt;In proxmox, click node -&amp;gt; network -&amp;gt; interface -&amp;gt; enable vlan aware&lt;/li&gt;
&lt;li&gt;In proxmox, opnsense VM hardware settings -&amp;gt; tag wan interface with vlan&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;details&quot; tabindex=&quot;-1&quot;&gt;Details &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/opnsense/opnsense-high(er)-availablility/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;h3 id=&quot;topology&quot; tabindex=&quot;-1&quot;&gt;Topology &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/opnsense/opnsense-high(er)-availablility/&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;This requires a managed switch with vlans.  Plug the cable modem into one of the switch ports, enter the switch admin console, and select a vlan for that port (10, for example) and leave it untagged.  Next, configure the ports that your Proxmox hosts are plugged into as tagged on the vlan you selected and untagged on the default or LAN vlan.&lt;/p&gt;
&lt;p&gt;In this screenshot, my modem is plugged into port 12 and my Proxmox hosts are plugged into ports 3, 9, and 10:&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/Hkmmh5nko6-728.avif 728w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/Hkmmh5nko6-728.webp 728w&quot;&gt;&lt;img alt=&quot;example switch config&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/Hkmmh5nko6-728.jpeg&quot; width=&quot;728&quot; height=&quot;184&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;h3 id=&quot;proxmox-config&quot; tabindex=&quot;-1&quot;&gt;Proxmox config &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/opnsense/opnsense-high(er)-availablility/&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Under each node&#39;s network settings, select your bridge (vmbr0) and check the &amp;quot;vlan aware&amp;quot; box.  That&#39;s all you have to do here.&lt;/p&gt;
&lt;h3 id=&quot;opnsense-vm-config&quot; tabindex=&quot;-1&quot;&gt;Opnsense VM Config &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/opnsense/opnsense-high(er)-availablility/&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;Two virtual network interfaces need to be added to the VM (click the vm -&amp;gt; hardware -&amp;gt; add).  For Bridge, select the your vlan-aware bridge (vmbr0).  The first interface should be untagged (or tagged with your LAN vlan).  The second interface should be tagged with your WAN vlan.&lt;/p&gt;
&lt;p&gt;For example:&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/4GKgCDlw_R-597.avif 597w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/4GKgCDlw_R-597.webp 597w&quot;&gt;&lt;img alt=&quot;opnsense VM interface config&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/4GKgCDlw_R-597.jpeg&quot; width=&quot;597&quot; height=&quot;263&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;In opnsense admin console, go to Interfaces -&amp;gt; add interface for LAN and WAN, select the appropriate virtual adapter for each.&lt;/p&gt;
&lt;h3 id=&quot;proxmox-migrations&quot; tabindex=&quot;-1&quot;&gt;Proxmox Migrations &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/opnsense/opnsense-high(er)-availablility/&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;In order to migrate, the nodes must have a shared storage.  You can also use a local storage, provided it is the same name and type across each node (no mixing local-lvm + local-zfs).  In order to avoid copying the entire VM disk for each migrate, you&#39;ll want to go to the VM settings and set up a replication job on a somewhat frequent basis.  Proxmox can then do a super fast incremental update to the VM disk and then just copy the VM&#39;s memory contents.  If your VM has 4GB ram, for example, the migrate will only need to transfer 4GB if you&#39;ve replicated the disk.&lt;/p&gt;
&lt;p&gt;Replication example:&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/mfgIHzPvhP-644.avif 644w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/mfgIHzPvhP-644.webp 644w&quot;&gt;&lt;img alt=&quot;example replication job&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/mfgIHzPvhP-644.jpeg&quot; width=&quot;644&quot; height=&quot;428&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;High availability can now be configured under Datacenter -&amp;gt; High Availability.  Or, you can enjoy the live-migrate functionality as-needed, without configuring HA.&lt;/p&gt;
&lt;h3 id=&quot;it-s-really-fast&quot; tabindex=&quot;-1&quot;&gt;it&#39;s really fast! &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/opnsense/opnsense-high(er)-availablility/&quot;&gt;#&lt;/a&gt;&lt;/h3&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/OIOJK9Cuft-896.avif 896w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/OIOJK9Cuft-896.webp 896w&quot;&gt;&lt;img alt=&quot;example migration&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/OIOJK9Cuft-896.jpeg&quot; width=&quot;896&quot; height=&quot;555&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;h2 id=&quot;happy-homelabbing&quot; tabindex=&quot;-1&quot;&gt;Happy homelabbing! &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/opnsense/opnsense-high(er)-availablility/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
</content>
	</entry>
	
	<entry>
		<title>OpenVPN inside LXC container</title>
		<link href="https://stinky.blog/blog/openvpn-inside-lxc-container/"/>
		<updated>2024-05-27T00:00:00Z</updated>
		<id>https://stinky.blog/blog/openvpn-inside-lxc-container/</id>
		<content type="html">&lt;h2 id=&quot;why-not-wireguard&quot; tabindex=&quot;-1&quot;&gt;Why not Wireguard &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/openvpn-inside-lxc-container/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;My little qbittorrent container has been chugging along for a couple years now, happily connected to its VPN over wireguard.  It has worked great! ...Until now.&lt;/p&gt;
&lt;p&gt;Recently I noticed that it was suddenly struggling to maintain connections.  Even extremely active torrents were stalling out completely -- 0 peers connected, 0 seeds connected.  Not sure what exactly has changed with how the VPN routes traffic to cause this, but I needed to correct it.  No more passive peering for me, time to set up port forwarding the right way.&lt;/p&gt;
&lt;p&gt;My VPN provider does offer port forwarding for Wireguard, but only within their little app.  I&#39;m not using the app.  I have purchased a static IP from them and I connect directly.  They only support OpenVPN for port forwarding in this situation.&lt;/p&gt;
&lt;h2 id=&quot;why-it-doesn-t-work&quot; tabindex=&quot;-1&quot;&gt;Why it doesn&#39;t work &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/openvpn-inside-lxc-container/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Just like with samba/nfs and gpu transcoding, LXC containers need to be privileged in order to access certain kernel modules.  OpenVPN creates a new device in /dev/net/tun using kernel module &amp;quot;tun&amp;quot; -- that ain&#39;t gonna work in a LXC.&lt;/p&gt;
&lt;p&gt;Googling it brings up various methods involving adding lines to your LXC config file in /etc/pve on the Proxmox host and then doing some user masking similar to samba/nfs.  I didn&#39;t have to do any of that.  All I had to do was add /dev/net/tun as a passthrough device in the &amp;quot;Resources&amp;quot; section of the LXC options.&lt;/p&gt;
&lt;h2 id=&quot;the-steps&quot; tabindex=&quot;-1&quot;&gt;The steps &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/openvpn-inside-lxc-container/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Install openvpn in the container&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; openvpn&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Generate config file or download from VPN provider, place file in:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;/etc/openvpn/&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;yourfile&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;.conf&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Make a credentials file&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;nano&lt;/span&gt; /etc/openvpn/creds&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Use this format:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;username
password&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Save the file and secure it:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;chmod&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;600&lt;/span&gt; /etc/openvpn/creds&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Add the location of your credentials file to your OpenVPN config:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;nano&lt;/span&gt; /etc/openvpn/&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;yourfile&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;.conf&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Look for &amp;quot;auth-user-pass&amp;quot; and add the path to the creds file:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;auth-user-pass /etc/openvpn/creds&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Navigate to the container settings in Proxmox.&lt;/p&gt;
&lt;p&gt;Select the &amp;quot;Options&amp;quot; tab.&lt;/p&gt;
&lt;p&gt;Click Features --&amp;gt; Enable Nesting and Create Device Nodes&lt;/p&gt;
&lt;p&gt;Select the &amp;quot;Resources&amp;quot; tab.&lt;/p&gt;
&lt;p&gt;Click Add --&amp;gt; Device Passthrough&lt;/p&gt;
&lt;p&gt;Device path: /dev/net/tun  --&amp;gt;  Click Add&lt;/p&gt;
&lt;p&gt;Reboot the container.  Test the connection:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;openvpn &lt;span class=&quot;token parameter variable&quot;&gt;--config&lt;/span&gt; /etc/openvpn/&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;yourfile&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;.conf&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token number&quot;&gt;2024&lt;/span&gt;-05-27 &lt;span class=&quot;token number&quot;&gt;23&lt;/span&gt;:48:24 TUN/TAP device tun0 opened&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Tadaaaaaaa!&lt;/p&gt;
&lt;hr&gt;
&lt;h2 id=&quot;connect-automatically&quot; tabindex=&quot;-1&quot;&gt;Connect automatically &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/openvpn-inside-lxc-container/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Make a systemd timer:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;nano&lt;/span&gt; /etc/systemd/system/openvpn@yourname.service&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;With these contents (edit the filename):&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Unit&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Description&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;OpenVPN connection
&lt;span class=&quot;token assign-left variable&quot;&gt;After&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;network.target

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Service&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;simple
&lt;span class=&quot;token assign-left variable&quot;&gt;ExecStart&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/usr/sbin/openvpn &lt;span class=&quot;token parameter variable&quot;&gt;--config&lt;/span&gt; /etc/openvpn/&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;yourname&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;.conf
&lt;span class=&quot;token assign-left variable&quot;&gt;Restart&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;on-failure

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Install&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;WantedBy&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;multi-user.target&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Enable and start it:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;systemctl daemon-reload
systemctl &lt;span class=&quot;token builtin class-name&quot;&gt;enable&lt;/span&gt; openvpn@yourname
systemctl start openvpn@yourname&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Enjoy!&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>Go time</title>
		<link href="https://stinky.blog/blog/go-time/"/>
		<updated>2024-04-03T00:00:00Z</updated>
		<id>https://stinky.blog/blog/go-time/</id>
		<content type="html">&lt;p&gt;Taking notes while learning some Go&lt;/p&gt;
&lt;h2 id=&quot;go-concepts&quot; tabindex=&quot;-1&quot;&gt;Go concepts &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/go-time/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Every Go file is part of a package.&lt;/p&gt;
&lt;p&gt;Packages contain a collection of Go files.&lt;/p&gt;
&lt;p&gt;Modules contain a collection of packages.&lt;/p&gt;
&lt;h2 id=&quot;initialize-a-project&quot; tabindex=&quot;-1&quot;&gt;Initialize a project &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/go-time/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;go mod init &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;pj name or github address&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;main&quot; tabindex=&quot;-1&quot;&gt;Main &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/go-time/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;main is a special package that tells the compiler where your program begins&lt;/p&gt;
&lt;pre class=&quot;language-go&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;main package requires a main function:&lt;/p&gt;
&lt;pre class=&quot;language-go&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;import packages with &#39;import&#39;&lt;/p&gt;
&lt;p&gt;use &#39;fmt&#39; package to print stuff to the screen&lt;/p&gt;
&lt;pre class=&quot;language-go&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hi friend!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;build the program with go build:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;go build whatever.go&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;run the program with go run:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;go run whatever.go&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;Hi friend&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;daaaaaaang, im ready for devops&lt;/p&gt;
&lt;h2 id=&quot;variables&quot; tabindex=&quot;-1&quot;&gt;Variables &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/go-time/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Variable type must be declared&lt;/p&gt;
&lt;pre class=&quot;language-go&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;name &lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-go&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; intNum &lt;span class=&quot;token builtin&quot;&gt;int64&lt;/span&gt;
    fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;intNum&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;int-types&quot; tabindex=&quot;-1&quot;&gt;int types &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/go-time/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;int8, int16, int32, int64 -- default 32/64 depending on arch&lt;/p&gt;
&lt;p&gt;unsigned ints for positive numbers only, lower memory cost:&lt;/p&gt;
&lt;p&gt;uint&lt;/p&gt;
&lt;h2 id=&quot;float&quot; tabindex=&quot;-1&quot;&gt;float &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/go-time/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;float32, float64, must specify&lt;/p&gt;
&lt;h2 id=&quot;booleans&quot; tabindex=&quot;-1&quot;&gt;booleans &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/go-time/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;bool, true or false&lt;/p&gt;
&lt;h2 id=&quot;combining-variables&quot; tabindex=&quot;-1&quot;&gt;Combining variables &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/go-time/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Variables must be same type to perform functions on them&lt;/p&gt;
&lt;p&gt;Can use comma, +, -, etc.&lt;/p&gt;
&lt;pre class=&quot;language-go&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hi again, old friend!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; awkward &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;I can&#39;t remember your name...&quot;&lt;/span&gt;
	name &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Old Friend&quot;&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;,&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; awkward&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ ./hi-friend
Hi again, old friend&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;
Old Friend, I can&#39;t remember your name&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;functions&quot; tabindex=&quot;-1&quot;&gt;Functions &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/go-time/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Functions follow the style func func-name(parameters) return-type { }&lt;/p&gt;
&lt;p&gt;the return type must be declared, in this case we return a string:&lt;/p&gt;
&lt;pre class=&quot;language-go&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;hello_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Howdy, &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; name
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Functions can be combined on one line:&lt;/p&gt;
&lt;pre class=&quot;language-go&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;language&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tongue &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;I don&#39;t know any &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; tongue
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;hello_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Howdy, &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot; -- &quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        name &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Skeeter&quot;&lt;/span&gt;
        tongue &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Python&quot;&lt;/span&gt;
        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;hello_name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;language&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tongue&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ go run language.go
Howdy, Skeeter --  I don&#39;t know any Python&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;arrays&quot; tabindex=&quot;-1&quot;&gt;Arrays &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/go-time/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Arrays are fixed size, cannot change&lt;/p&gt;
&lt;p&gt;var array1 [# of items]type = [# of items]type{item1, item2, item3}&lt;/p&gt;
&lt;pre class=&quot;language-go&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; array1 &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;42&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;52&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;62&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;72&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;82&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;slices&quot; tabindex=&quot;-1&quot;&gt;Slices &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/go-time/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;like arrays, but no need to define the size.  Can grow and shrink.  use append function to grow&lt;/p&gt;
&lt;pre class=&quot;language-go&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;slice1 &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;42&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;52&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;62&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;72&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;82&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;loops&quot; tabindex=&quot;-1&quot;&gt;Loops &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/go-time/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;pre class=&quot;language-go&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        week &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;thursday&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;friday&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;saturday&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;sunday&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;monday&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;tuesday&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;wednesday&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; index&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; day &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; week &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;index&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; day&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;maps&quot; tabindex=&quot;-1&quot;&gt;Maps &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/go-time/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;like a dictionary, with key:value.&lt;/p&gt;
&lt;p&gt;make(map[key-type]value-type)&lt;/p&gt;
&lt;p&gt;manipulating items in a map:&lt;/p&gt;
&lt;pre class=&quot;language-go&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        phoneBook &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// add stuff to map&lt;/span&gt;
        phoneBook&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Brian&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;111-1111&quot;&lt;/span&gt;
        phoneBook&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Skeeter&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;111-2222&quot;&lt;/span&gt;
        phoneBook&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Jalapeno&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;111-3333&quot;&lt;/span&gt;
        phoneBook&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Poblano&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;111-4444&quot;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// print current book&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; number &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; phoneBook &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;--&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; number&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// change Skeeter&#39;s number&lt;/span&gt;
        phoneBook&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Skeeter&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;222-1111&quot;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// warn the user&lt;/span&gt;
        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;...&#92;nA number changed!&#92;n...&#92;nHere&#39;s the new phonebook:&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; number &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; phoneBook &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;--&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; number&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// delete Poblano&#39;s number&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;phoneBook&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Poblano&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// deliver a eulogy&lt;/span&gt;
        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;...&#92;nPoblano is no longer with us...&#92;n...&#92;nRIP, Poblano.&#92;n...&#92;nHere&#39;s the new phonebook:&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; number &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; phoneBook &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;--&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; number&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;user-inputs-nested-if-elif&quot; tabindex=&quot;-1&quot;&gt;User inputs, nested if/elif &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/go-time/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;fmt.Scanln(desiredinput)&lt;/p&gt;
&lt;pre class=&quot;language-go&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&quot;math/rand&quot;&lt;/span&gt;
        &lt;span class=&quot;token string&quot;&gt;&quot;time&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;token comment&quot;&gt;// ask questions&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; numguesses &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; numrange &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Welcome to the guessing game!&#92;n...&#92;nGuess my number and win the prize!&#92;n...&#92;nHow many guesses would you like? (1-99)&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Scanln&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;numguesses&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;numguesses&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot; guesses, you got it.&#92;n...&#92;nNow choose the range! Between 1 and __ (max 100):&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Scanln&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;numrange&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                        &lt;span class=&quot;token comment&quot;&gt;// plant seeds&lt;/span&gt;
        rand&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Seed&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;UnixNano&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                        &lt;span class=&quot;token comment&quot;&gt;// sprout seed&lt;/span&gt;
        randnum &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; rand&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Intn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;numrange&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; guess &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
        attempts &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; numguesses
                        &lt;span class=&quot;token comment&quot;&gt;// start game&lt;/span&gt;
                fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Guess a number between 1 and &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; numrange&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt;  &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; attempts&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Enter your guess: &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Scanln&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;guess&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                        &lt;span class=&quot;token comment&quot;&gt;// give hints&lt;/span&gt;
                        &lt;span class=&quot;token comment&quot;&gt;// calculate difference&lt;/span&gt;
                difference &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; guess &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; randnum
                        &lt;span class=&quot;token comment&quot;&gt;// if negative, make positive&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; difference &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        difference &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;difference
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; guess &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; randnum &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; difference &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; numrange&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Way too low!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Too low!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; guess &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; randnum &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; difference &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; numrange&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Way too high!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Too high!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;You got it! The number was &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; randnum&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Out of guesses! Better luck next time. The number was &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; randnum&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;simple-math-if-else-practice&quot; tabindex=&quot;-1&quot;&gt;simple math / if-else practice &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/go-time/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;pre class=&quot;language-go&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; main &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;token comment&quot;&gt;// get current age&lt;/span&gt;
                fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hey! how old are you?&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; age &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
                fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Scanln&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;age&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                        &lt;span class=&quot;token comment&quot;&gt;// calculate # of years until you can do stuff&lt;/span&gt;
                        &lt;span class=&quot;token comment&quot;&gt;// if negative, make positive&lt;/span&gt;
                fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Cool!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; age&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;years old.  Let&#39;s see your milestones:&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;...&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; yearstoadult &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
                yearstoadult &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;18&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; age
                        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; yearstoadult &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;You will be an adult in&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; yearstoadult&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;years.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; yearstoadult &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        yearstoadult &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;yearstoadult
                        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;You became an adult&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; yearstoadult&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;years ago.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; yearstoadult &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;You became an adult this year!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;...&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; yearstodrink &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
                yearstodrink &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; age
                        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; yearstodrink &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;You can buy alcoholic beverages in&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; yearstodrink&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;years.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; yearstodrink &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        yearstodrink &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;yearstodrink
                        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;You were able to buy alcoholic beverages&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; yearstodrink&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;years ago.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; yearstodrink &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;You can buy alcoholic beverages this year!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;...&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; yearstocar &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
                yearstocar &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; age
                        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; yearstocar &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;You can rent a car in&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; yearstocar&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;years.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; yearstocar &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        yearstocar &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;yearstocar
                        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;You were able to rent a car&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; yearstocar&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;years ago.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; yearstocar &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;You can rent a car this year!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;...&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; yearstoretire &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
                yearstoretire &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;67&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; age
                        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; yearstoretire &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;You can retire in&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; yearstoretire&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;years.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; yearstoretire &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        yearstoretire &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;yearstoretire
                        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;You could have retired&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; yearstoretire&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;years ago.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; yearstoretire &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;You can retire this year!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;chat jippity said I should clean that up a bit and not repeat myself.  Let&#39;s try:&lt;/p&gt;
&lt;pre class=&quot;language-go&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
                &lt;span class=&quot;token comment&quot;&gt;//calculate age until milestones&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ageCalc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;age&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; milestoneAge &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; milestoneName &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        years &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; milestoneAge &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; age
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; years &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%s in %d years.&#92;n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; milestoneName&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; years&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; years &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%s %d years ago&#92;n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; milestoneName&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;years&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%s this year!&#92;n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; milestoneName&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token comment&quot;&gt;//ask for age&lt;/span&gt;
        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hey! How old are you?&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; age &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Scanln&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;age&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Cool!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; age&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;years old. Let&#39;s see your milestones:&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;...&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token comment&quot;&gt;//use ageCalc function to print results&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;ageCalc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;age&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;18&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Reach adulthood --&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;ageCalc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;age&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Buy alcoholic beverages --&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;ageCalc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;age&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Rent a car --&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;ageCalc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;age&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;67&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Retirement age --&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;...&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;From 74 lines to 29 lines.  Not bad&lt;/p&gt;
&lt;h2 id=&quot;compile-for-windows&quot; tabindex=&quot;-1&quot;&gt;compile for windows &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/go-time/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token assign-left variable&quot;&gt;GOOS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;windows &lt;span class=&quot;token assign-left variable&quot;&gt;GOARCH&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;amd64 go build &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; age-calc-v2.exe age-calc-v2.go&lt;/code&gt;&lt;/pre&gt;
</content>
	</entry>
	
	<entry>
		<title>ZFS on Thinkpad: Automated Snapshots</title>
		<link href="https://stinky.blog/blog/zfs-on-thinkpad-automated-snapshots/"/>
		<updated>2024-03-30T00:00:00Z</updated>
		<id>https://stinky.blog/blog/zfs-on-thinkpad-automated-snapshots/</id>
		<content type="html">&lt;h2 id=&quot;snapshotting-the-whole-world&quot; tabindex=&quot;-1&quot;&gt;Snapshotting the whole world &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-on-thinkpad-automated-snapshots/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;I had a lot of fun setting up &lt;a href=&quot;https://stinky.blog/blog/zfs-fileserver-automated-snapshots/&quot;&gt;automated snapshots on the fileserver&lt;/a&gt;.  It made me realize that it would probably be pretty easy to do the same thing for my laptop.&lt;/p&gt;
&lt;p&gt;I wanted to avoid having to install Arch from scratch using one of the ZFS bootloader solutions, so I tried to find a distro with a ZFS on root installer.  I remembered that Ubuntu had ZFS support, but it looks like they have since removed it from the v23+ installers.&lt;/p&gt;
&lt;p&gt;It&#39;s pretty surprising to me that almost nobody offers ZFS on root except Proxmox.  Guess that&#39;s why Proxmox is so awesome.&lt;/p&gt;
&lt;p&gt;I was able to find an Arch-based distro with ZFS on root called &lt;a href=&quot;https://cachyos.org&quot;&gt;CachyOS&lt;/a&gt;, which actually looks pretty dang slick.  It also has a package repository with tons of packages rebuilt with LTO/x86-64-v3 for better performance.  The default options are not bad either -- so similar to EndeavourOS that I literally just copied my home folder over after installation and everything works.&lt;/p&gt;
&lt;p&gt;The default ZFS options aren&#39;t bad in CachyOS either.  The max ARC size is set to like 90% of system ram (currently 14gb on my 16gb thinkpad), and the default datasets look like this:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;❯ zfs list
NAME                          USED  AVAIL  REFER  MOUNTPOINT
zpcachyos                    &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;.0G   445G    96K  none
zpcachyos/ROOT               &lt;span class=&quot;token number&quot;&gt;11&lt;/span&gt;.9G   445G    96K  none
zpcachyos/ROOT/cos           &lt;span class=&quot;token number&quot;&gt;11&lt;/span&gt;.9G   445G    96K  none
zpcachyos/ROOT/cos/home      &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;.59G   445G  &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;.46G  /home
zpcachyos/ROOT/cos/root      &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;.14G   445G  &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;.13G  /
zpcachyos/ROOT/cos/varcache  &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;.16G   445G  &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;.16G  /var/cache
zpcachyos/ROOT/cos/varlog     540K   445G   300K  /var/log&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;setting-up-snapshots&quot; tabindex=&quot;-1&quot;&gt;Setting up snapshots &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-on-thinkpad-automated-snapshots/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;I installed sanoid from the arch repo and then just copied my own instructions from the fileserver snapshot post linked above.  Only had to change the dataset names and modify the syncoid command.&lt;/p&gt;
&lt;p&gt;just had to add recursive option to the sanoid.conf for this machine:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;zpcachyos/ROOT&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        use_template &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; production
        recursive &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;yes&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;## templates&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;template_production&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        frequently &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;
        hourly &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;24&lt;/span&gt;
        daily &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
        monthly &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
        yearly &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
        autosnap &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;yes&lt;/span&gt;
        autoprune &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;yes&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;template_backup&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        autoprune &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;yes&lt;/span&gt;
        frequently &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
        hourly &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;72&lt;/span&gt;
        daily &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;
        monthly &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;
        yearly &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
        autosnap &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; no&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;In the fileserver examples, both of those proxmox hosts were logged in as root, which meant I needed to use --no-privilege-elevation in the syncoid command.&lt;/p&gt;
&lt;p&gt;The thinkpad is obviously not logged in as root, so it needs to run the syncoid command as sudo, but still needs --no-privilege-elevation or else it will be trying to use &amp;quot;sudo&amp;quot; on the backup server as well.&lt;/p&gt;
&lt;p&gt;Working command (-F the first time):&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; syncoid &lt;span class=&quot;token parameter variable&quot;&gt;-r&lt;/span&gt; --no-privilege-elevation zpcachyos/ROOT thinkstation2:bigpool/snapshots/thinkpad&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;How it looks on the backup server:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;root@thinkstation2:/bigpool/snapshots/thinkpad&lt;span class=&quot;token comment&quot;&gt;# tree -La 2&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;
└── cos
    ├── home
    ├── root
    ├── varcache
    └── varlog&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I copied and pasted the exact same systemd timer (syncoid.timer) from the backup server for use on this machine.&lt;/p&gt;
&lt;p&gt;to do:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;create send/recv user, minimum permissions&lt;/li&gt;
&lt;li&gt;zfs delegation&lt;/li&gt;
&lt;/ul&gt;
</content>
	</entry>
	
	<entry>
		<title>ZFS Fileserver: Automated snapshots</title>
		<link href="https://stinky.blog/blog/zfs-fileserver-automated-snapshots/"/>
		<updated>2024-03-24T00:00:00Z</updated>
		<id>https://stinky.blog/blog/zfs-fileserver-automated-snapshots/</id>
		<content type="html">&lt;h2 id=&quot;backing-up-the-new-zfs-fileserver&quot; tabindex=&quot;-1&quot;&gt;Backing up the new ZFS Fileserver &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-fileserver-automated-snapshots/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;In the &lt;a href=&quot;https://stinky.blog/blog/zfs-fileserver/&quot;&gt;last post&lt;/a&gt;, I got the LXC fileserver working with a ZFS dataset passed through as a bind mount.  I ran some quick benchmarks and discovered that the container is significantly faster than the old VM in many workloads.&lt;/p&gt;
&lt;p&gt;Before ditching the VM fileserver completely, I still have to nail down a backup solution.  Proxmox Backup Server can backup the container&#39;s primary disk and its configuration file, but it won&#39;t be able to backup the data on the bind mount.&lt;/p&gt;
&lt;h2 id=&quot;zfs-snapshots&quot; tabindex=&quot;-1&quot;&gt;ZFS snapshots &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-fileserver-automated-snapshots/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Since my Proxmox Backup Server uses ZFS as well, I should be able to just use built-in zfs tools to snapshot the fileserver and then use zfs send/receive to send them to the backup server.  Then I should be able to prune them with a little script.&lt;/p&gt;
&lt;p&gt;There are a number of solutions to automate this process, including &lt;a href=&quot;https://github.com/psy0rz/zfs_autobackup&quot;&gt;zfs_autobackup&lt;/a&gt; and &lt;a href=&quot;https://github.com/jimsalterjrs/sanoid&quot;&gt;Sanoid / Syncoid&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;But before I try one of those auto-magic scripts, I want to do it manually a few times just so I understand the process.&lt;/p&gt;
&lt;h2 id=&quot;learning-to-snapshot-and-zfs-send-receive&quot; tabindex=&quot;-1&quot;&gt;Learning to snapshot and zfs send/receive &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-fileserver-automated-snapshots/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;From what I understand, the first snapshot I take of the dataset will be a full copy of the data. I&#39;ll be able to just send incrementals to the remote server after that.&lt;/p&gt;
&lt;p&gt;So let&#39;s take the first snapshot.  Connected to the Proxmox host with ssh:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;root@thinkstation:~&lt;span class=&quot;token comment&quot;&gt;# zfs list&lt;/span&gt;
NAME                      USED  AVAIL  REFER  MOUNTPOINT
fast                     &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;.43T  &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;.79T  &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;.00G  /fast
fast/fileserver            96K  &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;.79T    96K  /fast/fileserver&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;There she is.  Let&#39;s snapshot:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;zfs snapshot fast/fileserver@initial&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;No output... where&#39;d it go?&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;root@thinkstation:~&lt;span class=&quot;token comment&quot;&gt;# zfs list -t snapshot&lt;/span&gt;
NAME                      USED  AVAIL  REFER  MOUNTPOINT
fast/fileserver@initial     0B      -    96K  -
root@thinkstation:~&lt;span class=&quot;token comment&quot;&gt;# &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Cool!  But where is that?&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;root@thinkstation:/fast/fileserver/.zfs/snapshot&lt;span class=&quot;token comment&quot;&gt;# ls&lt;/span&gt;
initial&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;So snapshots are stored in the root of the dataset, in a hidden folder called .zfs/snapshot -- got it.&lt;/p&gt;
&lt;p&gt;Now how do I send this to the zfs pool on the proxmox backup server?&lt;/p&gt;
&lt;p&gt;First I need to create a new dataset on the backup server for the snapshots.  I created another dataset inside that one just for the fileserver.&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;root@thinkstation2:~&lt;span class=&quot;token comment&quot;&gt;# zfs create bigpool/snapshots&lt;/span&gt;
root@thinkstation2:~&lt;span class=&quot;token comment&quot;&gt;# zfs create bigpool/snapshots/fileserver&lt;/span&gt;
root@thinkstation2:~&lt;span class=&quot;token comment&quot;&gt;# zfs list&lt;/span&gt;
NAME                           USED  AVAIL  REFER  MOUNTPOINT
bigpool                       &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;.76T  &lt;span class=&quot;token number&quot;&gt;18&lt;/span&gt;.9T   104K  /bigpool
bigpool/pbs                   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;.72T  &lt;span class=&quot;token number&quot;&gt;18&lt;/span&gt;.9T  &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;.72T  /bigpool/pbs
bigpool/snapshots              192K  &lt;span class=&quot;token number&quot;&gt;18&lt;/span&gt;.9T    96K  /bigpool/snapshots
bigpool/snapshots/fileserver    96K  &lt;span class=&quot;token number&quot;&gt;18&lt;/span&gt;.9T    96K  /bigpool/snapshots/fileserver&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Ok, let&#39;s try to send it.&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;zfs send fast/fileserver@intial &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ssh&lt;/span&gt; thinkstation2 zfs receive bigpool/snapshots/fileserver&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I get a warning about overwriting the dataset, must add -F to continue.  Sure!&lt;/p&gt;
&lt;p&gt;Did it work?&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;root@thinkstation2:~&lt;span class=&quot;token comment&quot;&gt;# ls /bigpool/snapshots/fileserver/.zfs/snapshot/&lt;/span&gt;
initial&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Heck yea!  Now I know how to create the snapshots.  How do I restore them?&lt;/p&gt;
&lt;h2 id=&quot;restoring-a-snapshot&quot; tabindex=&quot;-1&quot;&gt;Restoring a snapshot &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-fileserver-automated-snapshots/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;First, I&#39;ll try a local snapshot restore.  I created a file on the fileserver named &amp;quot;ghost&amp;quot;.  Let&#39;s rollback the fileserver to the initial state and make the ghost disapppear.&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;zfs rollback fast/fileserver@initial&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It worked!  The ghost disappeared:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;brian@thinkpad-x390 ~/test $ &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt;
ghost-file
brian@thinkpad-x390 ~/test $ &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt;
brian@thinkpad-x390 ~/test $ &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now can we do the same thing with the remote snapshot?&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;root@thinkstation:~&lt;span class=&quot;token comment&quot;&gt;# ssh thinkstation2 &quot;zfs send bigpool/snapshots/fileserver@initial&quot; | zfs receive -F fast/fileserver&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It worked again!  No ghost:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;brian@thinkpad-x390 ~/test $ &lt;span class=&quot;token function&quot;&gt;touch&lt;/span&gt; ghost
brian@thinkpad-x390 ~/test $ &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt;
brian@thinkpad-x390 ~/test $ &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Alright!  I just wanted to make sure I understood the process before I started running random scripts from github.  Knowing how to manually snapshot, send and receive, restore, and delete seems like enough to get started with some automation.&lt;/p&gt;
&lt;h2 id=&quot;automating-the-process&quot; tabindex=&quot;-1&quot;&gt;Automating the process &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-fileserver-automated-snapshots/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Sanoid/Syncoid looks like a solid choice to test out first.  The author&#39;s great posts on various zfs forums are what caused me to go down that volblocksize rabbit hole in the last few posts.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Sanoid&lt;/strong&gt; creates and prunes snapshots according to policy.  The policy is contained in /etc/sanoid.conf, and it&#39;s pretty easy to understand.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Syncoid&lt;/strong&gt; then syncs those snapshots from one machine to another.&lt;/p&gt;
&lt;p&gt;I will be using both tools to accomplish my goal here.&lt;/p&gt;
&lt;p&gt;Sanoid will run on both the fileserver (Proxmox host) and the backup server.  It will create the snapshots on the fileserver, and it will prune the snapshots on the backup server.&lt;/p&gt;
&lt;p&gt;Syncoid will only run on the backup server, to pull the snapshots at a certain interval.  There are security benefits to using this &amp;quot;pull&amp;quot; method, namely that if the primary server is compromised, the attacker does not also have access to the backup server.  The backup server only needs a ssh key and read access in order to complete the pull.  If you were &amp;quot;pushing&amp;quot;, the primary server would have write access to snapshots on the backup server.&lt;/p&gt;
&lt;p&gt;Before trying to configure Sanoid, I tested Syncoid.  I ssh&#39;d into backup server and pulled the initial snapshot from the fileserver:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;root@thinkstation2:~&lt;span class=&quot;token comment&quot;&gt;# syncoid --no-privilege-elevation thinkstation:fast/fileserver bigpool/snapshots/fileserver&lt;/span&gt;

root@thinkstation2:~&lt;span class=&quot;token comment&quot;&gt;# ls /bigpool/snapshots/fileserver/.zfs/snapshot&lt;/span&gt;
initial  syncoid_thinkstation2_2024-03-24:21:36:29-GMT-04:00&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;That worked great.  Next, I need to configure the Sanoid policy on the fileserver to create and retain snapshots.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;/etc/sanoid/sanoid.conf&lt;/strong&gt; on the fileserver:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;root@thinkstation:/etc/sanoid&lt;span class=&quot;token comment&quot;&gt;# cat sanoid.conf&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;fast/fileserver&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        use_template &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; production


&lt;span class=&quot;token comment&quot;&gt;## templates&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;template_production&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        frequently &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;
        hourly &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;24&lt;/span&gt;
        daily &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
        monthly &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
        yearly &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
        autosnap &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;yes&lt;/span&gt;
        autoprune &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;yes&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;template_backup&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        autoprune &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;yes&lt;/span&gt;
        frequently &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
        hourly &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;72&lt;/span&gt;
        daily &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;
        monthly &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;
        yearly &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
        autosnap &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; no&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It&#39;s short and sweet.  Name the pool/dataset at the top, and specify a template.  Then write the templates at the bottom.&lt;/p&gt;
&lt;p&gt;The production template I made here will take a snapshot every 15 minutes (frequently = 4, 4 per hour), 1 per hour, 1 per day.  It will retain 4 of the frequents, 24 of the hourlies, and the last 3 dailies.  That should be good enough for rewinding mistakes -- I don&#39;t want to clutter it up with any more than that.&lt;/p&gt;
&lt;p&gt;The backup template will retain 0 of the 15-minute snapshots, 72 of the hourlies, 30 dailies, and 6 monthlies.  That should be plenty for my homelab.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;autosnap&lt;/strong&gt; and &lt;strong&gt;autoprune&lt;/strong&gt; are important options here.  &lt;strong&gt;autosnap&lt;/strong&gt; tells Sanoid to create the snapshots at the specified intervals.  &lt;strong&gt;autoprune&lt;/strong&gt; tells Sanoid it&#39;s okay to delete snapshots that have expired according to the policy.&lt;/p&gt;
&lt;p&gt;For my setup, I want &lt;strong&gt;autosnap&lt;/strong&gt; enabled on the fileserver so it will create snapshots.  It needs to be disabled on the backup server though, or else the backup server will start snapshotting the snapshots!  &lt;strong&gt;autoprune&lt;/strong&gt; needs to be enabled on both machines, since they both need to delete snapshots according to their respective policies.&lt;/p&gt;
&lt;p&gt;Default systemd units look for Sanoid in /usr/local/sbin, so it didn&#39;t launch at first.  Added a symbolic link there to /sbin/sanoid for now.&lt;/p&gt;
&lt;p&gt;This config has been running in the background while I type all this mess, so let&#39;s see if it&#39;s working:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;root@thinkstation:/fast/fileserver/.zfs/snapshot&lt;span class=&quot;token comment&quot;&gt;# ls -t&lt;/span&gt;
autosnap_2024-03-25_23:00:06_frequently
autosnap_2024-03-25_23:00:06_hourly
autosnap_2024-03-25_22:45:05_frequently
autosnap_2024-03-25_22:30:00_frequently
autosnap_2024-03-25_22:15:06_frequently
autosnap_2024-03-25_22:00:06_frequently
initial&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The times are in UTC to avoid DST issues.  You can list them newest to oldest with &lt;strong&gt;ls -t&lt;/strong&gt; (ls -tr oldest to newest).&lt;/p&gt;
&lt;p&gt;Looking good so far!  Now I&#39;ll just copy and paste that same sanoid.conf to the backup server.  Only need to change the path to the pool and the template:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;bigpool/snapshots/fileserver&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        use_template &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; backup&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Let&#39;s run the syncoid command again and see if it worked:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;root@thinkstation2:/bigpool/snapshots/fileserver/.zfs/snapshot&lt;span class=&quot;token comment&quot;&gt;# ls -lt&lt;/span&gt;

drwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;19&lt;/span&gt;:51 syncoid_thinkstation2_2024-03-25:19:51:20-GMT-04:00
drwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;19&lt;/span&gt;:00 autosnap_2024-03-25_23:00:06_hourly
drwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;18&lt;/span&gt;:00 autosnap_2024-03-25_22:00:06_hourly
drwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;17&lt;/span&gt;:30 autosnap_2024-03-25_21:30:00_daily
drwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;17&lt;/span&gt;:30 autosnap_2024-03-25_21:30:00_hourly
drwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; Mar &lt;span class=&quot;token number&quot;&gt;24&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;:49 initial&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Perfect.  It&#39;s deleting everything except what&#39;s specified in the &#39;backup&#39; policy template.&lt;/p&gt;
&lt;p&gt;Now we&#39;re ready to schedule this process.&lt;/p&gt;
&lt;h2 id=&quot;running-syncoid-periodically&quot; tabindex=&quot;-1&quot;&gt;Running syncoid periodically &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-fileserver-automated-snapshots/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Now the backup server just needs a systemd timer that will run the syncoid service periodically.  Since I&#39;m only pulling hourly or older snapshots to the backup server, a timer that runs hourly should be fine.&lt;/p&gt;
&lt;p&gt;First I made the syncoid.service file.  Just copied the sanoid.service file and changed a couple words.  (symbolic link in /usr/local/sbin for /sbin/syncoid)&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;root@thinkstation2:/etc/systemd/system&lt;span class=&quot;token comment&quot;&gt;# cat syncoid.service &lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Unit&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Description&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;Replicate snapshots
&lt;span class=&quot;token assign-left variable&quot;&gt;Requires&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;zfs.target
&lt;span class=&quot;token assign-left variable&quot;&gt;After&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;zfs.target
&lt;span class=&quot;token assign-left variable&quot;&gt;Wants&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sanoid-prune.service
&lt;span class=&quot;token assign-left variable&quot;&gt;Before&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sanoid-prune.service
&lt;span class=&quot;token assign-left variable&quot;&gt;ConditionFileNotEmpty&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/etc/sanoid/sanoid.conf

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Service&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Environment&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;TZ&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;UTC
&lt;span class=&quot;token assign-left variable&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;oneshot
&lt;span class=&quot;token assign-left variable&quot;&gt;ExecStart&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/usr/local/sbin/syncoid --no-privilege-elevation thinkstation:fast/fileserver bigpool/snapshots/fileserver&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then I made the timer file, which will call the service file:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;root@thinkstation2:/etc/systemd/system&lt;span class=&quot;token comment&quot;&gt;# cat syncoid.timer&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Unit&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Description&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;Run Syncoid Every Hour
&lt;span class=&quot;token assign-left variable&quot;&gt;Requires&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;syncoid.service

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Timer&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;OnCalendar&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;hourly
&lt;span class=&quot;token assign-left variable&quot;&gt;Persistent&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Install&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;WantedBy&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;timers.target&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Let&#39;s see if they work:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;root@thinkstation2:~&lt;span class=&quot;token comment&quot;&gt;# systemctl status syncoid&lt;/span&gt;


Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:08:54 thinkstation2 systemd&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;: Finished syncoid.service - Replicate snapshots.&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Great!  And is pruning working?&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;root@thinkstation2:/bigpool/snapshots/fileserver/.zfs/snapshot&lt;span class=&quot;token comment&quot;&gt;# ls -lt&lt;/span&gt;

drwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:08 syncoid_thinkstation2_2024-03-26:02:08:49-GMT00:00
drwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;22&lt;/span&gt;:00 autosnap_2024-03-26_02:00:06_hourly
drwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt;:00 autosnap_2024-03-26_01:00:06_hourly
drwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; Mar &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;:00 autosnap_2024-03-26_00:00:01_daily&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Heck yea!  That was easier than I thought it would be.&lt;/p&gt;
&lt;p&gt;I&#39;ll let this run for a few days to make sure I didn&#39;t miss anything, but then it&#39;s time to send that fileserver VM to the trash and start using the new container!&lt;/p&gt;
&lt;p&gt;For now, I will still use Proxmox Backup Server for everything else.&lt;/p&gt;
&lt;h2 id=&quot;bonus-enable-previous-versions-in-windows&quot; tabindex=&quot;-1&quot;&gt;Bonus: Enable &amp;quot;previous versions&amp;quot; in Windows &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-fileserver-automated-snapshots/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Samba can use vfs shadow_copy2 to enable the &amp;quot;Previous Versions&amp;quot; feature when you right-click on files on Windows machines.&lt;/p&gt;
&lt;p&gt;It was super easy to turn on, just added the following at the bottom of the file share in /etc/samba/smb.conf:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;enable shadow copies &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; windows&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
vfs objects &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; shadow_copy2
shadow:snapdir &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; .zfs/snapshot
shadow:sort &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; desc
shadow:format &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; autosnap_%Y-%m-%d_%H:%M:%S_hourly&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;The container has samba 4.2 so it will only allow me to select one snapshot type (frequently, hourly, daily, etc).  Hourly seems good.&lt;/p&gt;
&lt;p&gt;That was really fun to learn!  Thanks for reading and happy homelabbing.&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>ZFS Fileserver: LXC+Dataset vs VM+Zvol</title>
		<link href="https://stinky.blog/blog/zfs-fileserver/"/>
		<updated>2024-03-23T00:00:00Z</updated>
		<id>https://stinky.blog/blog/zfs-fileserver/</id>
		<content type="html">&lt;h2 id=&quot;intro-recap&quot; tabindex=&quot;-1&quot;&gt;Intro / recap &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-fileserver/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Lately, I have been doing some benchmarking of my ZFS pools.  I have been trying to learn the performance impact of different volblocksizes when running VMs on ZFS.&lt;/p&gt;
&lt;p&gt;Selecting the wrong volblocksize can cause serious performance issues.  Even though my VMs been trucking along just fine, I wanted to learn more about this and how to properly optimize it for production workloads.&lt;/p&gt;
&lt;p&gt;You can see the results of &lt;a href=&quot;https://stinky.blog/blog/zfs-bench/&quot;&gt;round 1&lt;/a&gt; and &lt;a href=&quot;https://stinky.blog/blog/zfs-bench2/zfs-volblocksize-round-2/&quot;&gt;round 2&lt;/a&gt; here.&lt;/p&gt;
&lt;h2 id=&quot;vm-vs-lxc&quot; tabindex=&quot;-1&quot;&gt;VM vs LXC &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-fileserver/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;LXC:&lt;/strong&gt;
Originally, I ran my fileserver in a lightweight LXC container, using a storage-backed mount in Proxmox.  I passed the mount directory (ext4) into the container and shared it via samba/nfs.  Performance was great and it worked like a charm.  The only major downside for me was that Proxmox Backup Server would then have to scan the entire disk in order to make the daily backups.  LXC containers don&#39;t have a way to track changes to files, so even incremental backups still take way too long.  I was using 5TB spinning disks at the time, and backups were taking about 3.5 hours at a minimum, even if there was nothing new to backup.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;VM:&lt;/strong&gt;
Unlike LXCs, VMs do have a way to track which files have changed: dirty pages.  As long as the VM is online and has not rebooted since the last backup, it will only scan and transfer new or modified files.  This cut my backup times down from 3 hours to 3 minutes.&lt;/p&gt;
&lt;p&gt;I have run my fileserver in a VM on a ZFS pool for about a year and a half now.  It has worked great.  I love the integration with Proxmox Backup Server, which allows me to very quickly backup, restore, and migrate the entire VM along with all of its data.&lt;/p&gt;
&lt;p&gt;VMs running on ZFS pools in Proxmox introduce the volblocksize concept though, instead of using a recordsize.  While a sub-optimal recordsize isn&#39;t that big of a deal, setting the wrong volblocksize can be much worse.  That has been what I wanted to learn about through my testing.&lt;/p&gt;
&lt;h2 id=&quot;test-results-so-far&quot; tabindex=&quot;-1&quot;&gt;Test results so far &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-fileserver/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The benchmarks I&#39;ve run so far have led to more questions than answers.  The results are confusing.  I&#39;m not sure if my testing methodology is even sound for what I&#39;m looking to learn.  There is very little information online about volblocksize optimization and how to test it.  I think the general idea is that you should avoid zvols like the plague unless you know exactly what size blocks will be written from your workload, and you are able to tailor each zvol to the specific data that it will contain.  From my testing, speeds increase dramatically when pushing the volblocksize from the default 8k to as high as 64k.  I don&#39;t have a heavy database or write/rewrite in place workload to really test the downside of that change, though.&lt;/p&gt;
&lt;p&gt;So with that in mind, let&#39;s see if there&#39;s a way to avoid volblocksize completely, while retaining my favorite benefits of the VM.&lt;/p&gt;
&lt;h2 id=&quot;back-to-lxc&quot; tabindex=&quot;-1&quot;&gt;Back to LXC &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-fileserver/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;So, I will complete the circle and go back to using a LXC.  In order to avoid the super long backup times, I will switch up my backup process.&lt;/p&gt;
&lt;p&gt;Proxmox Backup Server uses its own method to create incremental backups, which requires either scanning the entire disk or using dirty-pages for a VM.  I will use zfs snapshots instead.  Since my Proxmox Backup Server has a 48TB ZFS pool, I can just use zfs send/receive to back them up on the same pool but without the long scan and transfer times.  Sending an incremental snapshot with zfs send should be nearly instant, no matter what the state of the container is.&lt;/p&gt;
&lt;p&gt;Unfortunately, it&#39;s not possible to do ZFS snapshots inside the PBS gui yet.  That&#39;s ok, though, since the commands should be pretty easy and scriptable.  I will just have PBS continue to backup the container itself with the backup job in the gui.&lt;/p&gt;
&lt;p&gt;There is one extra hoop to jump through in order to mount the zfs dataset inside the LXC, as well.  The datasets need to be created and then added to the container manually, rather than creating a fixed-size dataset within the Proxmox gui.&lt;/p&gt;
&lt;h2 id=&quot;setup&quot; tabindex=&quot;-1&quot;&gt;Setup &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-fileserver/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;First, I created a new dataset (fileserver) on my zpool (fast):&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;zfs create fast/fileserver&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then I configured permissions on the proxmox host.  &lt;a href=&quot;https://blog.kye.dev/proxmox-zfs-mounts&quot;&gt;This is a great guide&lt;/a&gt; on how to configure permissions for this specific scenario.  TLDR: Proxmox masks the true uid/gid inside containers for security reasons.  In order to share files on the host from inside an unprivileged container, this workaround (or manual user-mapping) is necessary.&lt;/p&gt;
&lt;p&gt;The uid/gid obfuscation works by adding 100,000 to whatever the container&#39;s value is.  So uid 1000 in the container is uid 101000 on the host.&lt;/p&gt;
&lt;p&gt;So I will make a fileserver users group with gid 110000 on the Proxmox host:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;groupadd&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-g&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;110000&lt;/span&gt; file_users&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;And then a user:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;useradd&lt;/span&gt; files &lt;span class=&quot;token parameter variable&quot;&gt;-u&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;101000&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-g&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;110000&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-s&lt;/span&gt; /bin/bash&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;chown the dataset to the new user and group:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;chown&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-R&lt;/span&gt; files:file_users /fast/fileserver/&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then I created a new unprivileged ubuntu23 container.&lt;/p&gt;
&lt;p&gt;Now start the container and add the user and group inside there:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;groupadd&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-g&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10000&lt;/span&gt; file_users
&lt;span class=&quot;token function&quot;&gt;useradd&lt;/span&gt; files &lt;span class=&quot;token parameter variable&quot;&gt;-u&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-g&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10000&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-s&lt;/span&gt; /bin/bash&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Shutdown the container.&lt;/p&gt;
&lt;p&gt;Finally, we just have to add the mountpoint to the container configuration file.  You can do this manually or just use pct set on the proxmox host:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;pct &lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;109&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-mp0&lt;/span&gt; /fast/fileserver,mp&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/mnt/files&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now run the container again.&lt;/p&gt;
&lt;p&gt;Tadaaaaaa:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;root@zfs-test:/mnt&lt;span class=&quot;token comment&quot;&gt;# ls&lt;/span&gt;
files
root@zfs-test:/mnt&lt;span class=&quot;token comment&quot;&gt;# &lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now before I get too excited and set up NFS and Samba, I&#39;d like to just run the same benchmark I ran in &lt;a href=&quot;https://stinky.blog/blog/zfs-bench/&quot;&gt;round 1&lt;/a&gt;.  Let&#39;s see how a raw dataset with 128k recordsize compares to all those volblocksizes.&lt;/p&gt;
&lt;h2 id=&quot;quick-bench&quot; tabindex=&quot;-1&quot;&gt;Quick bench &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-fileserver/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;fio &lt;span class=&quot;token parameter variable&quot;&gt;--name&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;random-write &lt;span class=&quot;token parameter variable&quot;&gt;--rw&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;randrw &lt;span class=&quot;token parameter variable&quot;&gt;--bs&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;4k &lt;span class=&quot;token parameter variable&quot;&gt;--size&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;4g &lt;span class=&quot;token parameter variable&quot;&gt;--numjobs&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--iodepth&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--runtime&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;60&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--time_based&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--end_fsync&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;4k random read/write:
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/Hqas4cqhHk-666.avif 666w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/Hqas4cqhHk-666.webp 666w&quot;&gt;&lt;img alt=&quot;4k random read/write performance&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/Hqas4cqhHk-666.png&quot; width=&quot;666&quot; height=&quot;500&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;The VM is a bit faster than the container for tiny writes.  What about 1M random?&lt;/p&gt;
&lt;p&gt;1M random read/write:
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/aTLJCUWlVl-666.avif 666w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/aTLJCUWlVl-666.webp 666w&quot;&gt;&lt;img alt=&quot;1M random read/write performance&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/aTLJCUWlVl-666.png&quot; width=&quot;666&quot; height=&quot;500&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;The container is &lt;strong&gt;102% faster&lt;/strong&gt; than the VM here.  It transferred &lt;strong&gt;72GB&lt;/strong&gt; while the VM only transferred &lt;strong&gt;36GB.&lt;/strong&gt;  Pretty cool!&lt;/p&gt;
&lt;h2 id=&quot;samba-time&quot; tabindex=&quot;-1&quot;&gt;samba time. &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-fileserver/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Just installed the base ubuntu &amp;quot;samba&amp;quot; package.  Made a basic smb.conf&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;files&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
   path &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; /mnt/files
   valid &lt;span class=&quot;token function&quot;&gt;users&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; files
   guest ok &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; no
   writable &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;yes&lt;/span&gt;
   browseable &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;yes&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;created user:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;smbpasswd &lt;span class=&quot;token parameter variable&quot;&gt;-a&lt;/span&gt; files&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;results&quot; tabindex=&quot;-1&quot;&gt;Results &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-fileserver/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Ran crystaldiskmark on the network share again, from my windows11 PC connected via 10GbE.&lt;/p&gt;
&lt;p&gt;In the container:&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/tpiLKNgtFo-482.avif 482w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/tpiLKNgtFo-482.webp 482w&quot;&gt;&lt;img alt=&quot;crystaldiskmark results in container with zfs dataset mount, network share&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/tpiLKNgtFo-482.png&quot; width=&quot;482&quot; height=&quot;355&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;In the VM:&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/qzUq7bzt-Z-482.avif 482w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/qzUq7bzt-Z-482.webp 482w&quot;&gt;&lt;img alt=&quot;64k volblocksize vm crystaldiskmark results&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/qzUq7bzt-Z-482.png&quot; width=&quot;482&quot; height=&quot;352&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;It&#39;s a lot faster!!&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Nearly doubled the write performance when writing to the dataset directly rather than through a zvol.&lt;/p&gt;
&lt;p&gt;Looking forward to learning how to automate snapshots and zfs send them to the Proxmox Backup Server!  Will post a follow up.&lt;/p&gt;
&lt;p&gt;Happy homelabbing!&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>Thinkpad Backup Script</title>
		<link href="https://stinky.blog/blog/thinkpad-backup/thinkpad-backup-script/"/>
		<updated>2024-03-22T00:00:00Z</updated>
		<id>https://stinky.blog/blog/thinkpad-backup/thinkpad-backup-script/</id>
		<content type="html">&lt;h2 id=&quot;fast-backups&quot; tabindex=&quot;-1&quot;&gt;Fast backups &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/thinkpad-backup/thinkpad-backup-script/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;I have been doing super lazy backups of my thinkpad for a while.  I just rsync the whole home folder to my fileserver.  That has been working okay, except that now I have a ton of files I&#39;d like to exclude from the backup to speed it up a bit.  I&#39;d also like the backup to run periodically in the background.&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Hi friend!  It&#39;s backup time.&quot;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;

&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Checking exclude file at &lt;span class=&quot;token environment constant&quot;&gt;$HOME&lt;/span&gt;/scripts/backup-excludes...&quot;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;

&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;...&quot;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;

&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Backing up /home/brian to file server...&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;#copy home folder to file server, minus exclude file:&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;rsync&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-aHvzPui&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--delete&lt;/span&gt; --exclude-from&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;/home/brian/scripts/backup-excludes.txt&#39;&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--stats&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--progress&lt;/span&gt; /home/brian/ files:/Vault/brian/current

&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Done!&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Obviously the script is not actually checking anything during the echo messages but that will help to remind me where the exclude file is whenever I run the script manually.&lt;/p&gt;
&lt;p&gt;The excludes file is just a txt file that lists Downloads/ and .*&lt;/p&gt;
&lt;p&gt;The rsync flags are for archive mode, preserve hard links, verbose mode, compression enabled, Partial progress (resuming), update only if modified date changed, and itemize summary of changes.&lt;/p&gt;
&lt;p&gt;I am also using the --delete option, which will &lt;strong&gt;delete all files from the destination that are no longer found in the source.&lt;/strong&gt; I snapshot the fileserver daily with Proxmox Backup Server, so I can recover any deleted files from a previous flieserver backup if I accidentally lose something.  This will just be a nice working copy of the laptop.&lt;/p&gt;
&lt;p&gt;Since I wrote a ssh config file and I use a key pair to login, I can skip password authentication and use the shortcut address files:/location.&lt;/p&gt;
&lt;p&gt;My scripts directory is added to my $PATH so I can execute the script manually by just typing&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;backup-thinkpad.sh&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It works pretty great!&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/aL38ajhhP5-800.avif 800w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/aL38ajhhP5-800.webp 800w&quot;&gt;&lt;img alt=&quot;running the thinkpad backup script&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/aL38ajhhP5-800.png&quot; width=&quot;800&quot; height=&quot;600&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>ZFS Volblocksize Round 2</title>
		<link href="https://stinky.blog/blog/zfs-bench2/zfs-volblocksize-round-2/"/>
		<updated>2024-03-21T00:00:00Z</updated>
		<id>https://stinky.blog/blog/zfs-bench2/zfs-volblocksize-round-2/</id>
		<content type="html">&lt;h2 id=&quot;round-2&quot; tabindex=&quot;-1&quot;&gt;Round 2! &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-bench2/zfs-volblocksize-round-2/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;I did a little bit more testing on volblocksizes.  This time I discovered a faster way to switch between each size.  I just added a new disk to my existing fileserver VM after changing the pool-wide volblocksize in the Proxmox GUI.  Run the test, delete the disk, change the size again, repeat.&lt;/p&gt;
&lt;p&gt;The fileserver VM is stored on a stripe of 2x 4TB ssd.&lt;/p&gt;
&lt;p&gt;I simulated some different fileserver workloads by copying various types of files from my Windows 11 desktop to the share.  The desktop is connected via 10GbE and has a fast nvme.&lt;/p&gt;
&lt;p&gt;Here are the transfer times for each run:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Transfer Time&lt;/th&gt;
&lt;th&gt;Size and Type&lt;/th&gt;
&lt;th&gt;Volblocksize&lt;/th&gt;
&lt;th&gt;Number of Files&lt;/th&gt;
&lt;th&gt;Average File Size&lt;/th&gt;
&lt;th&gt;Average Speed (MB/s)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;0:13&lt;/td&gt;
&lt;td&gt;6.2 GB zip file&lt;/td&gt;
&lt;td&gt;64k&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;6.2 GB&lt;/td&gt;
&lt;td&gt;477.54&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;0:13&lt;/td&gt;
&lt;td&gt;6.2 GB zip file&lt;/td&gt;
&lt;td&gt;8k&lt;/td&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;6.2 GB&lt;/td&gt;
&lt;td&gt;477.54&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1:38&lt;/td&gt;
&lt;td&gt;6.3 GB EverQuest folder&lt;/td&gt;
&lt;td&gt;64k&lt;/td&gt;
&lt;td&gt;18535&lt;/td&gt;
&lt;td&gt;~350 KB&lt;/td&gt;
&lt;td&gt;64.29&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1:55&lt;/td&gt;
&lt;td&gt;6.3 GB EverQuest folder&lt;/td&gt;
&lt;td&gt;8k&lt;/td&gt;
&lt;td&gt;18535&lt;/td&gt;
&lt;td&gt;~350 KB&lt;/td&gt;
&lt;td&gt;54.74&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1:24&lt;/td&gt;
&lt;td&gt;8.5 GB Resident Evil 5&lt;/td&gt;
&lt;td&gt;64k&lt;/td&gt;
&lt;td&gt;13692&lt;/td&gt;
&lt;td&gt;~640 KB&lt;/td&gt;
&lt;td&gt;101.19&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1:37&lt;/td&gt;
&lt;td&gt;8.5 GB Resident Evil 5&lt;/td&gt;
&lt;td&gt;8k&lt;/td&gt;
&lt;td&gt;13692&lt;/td&gt;
&lt;td&gt;~640 KB&lt;/td&gt;
&lt;td&gt;87.63&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2:18&lt;/td&gt;
&lt;td&gt;29.1 GB raw videos&lt;/td&gt;
&lt;td&gt;64k&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;14.55 GB&lt;/td&gt;
&lt;td&gt;210.76&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2:31&lt;/td&gt;
&lt;td&gt;29.1 GB raw videos&lt;/td&gt;
&lt;td&gt;8k&lt;/td&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;14.55 GB&lt;/td&gt;
&lt;td&gt;193.69&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;These results were the opposite of what I expected.  I would have expected 8k volblocksize to be faster for the 2 game folders, which contain a ridiculous number of tiny files.  I would also expect the difference to be larger in the raw video transfers.  Let&#39;s test more.&lt;/p&gt;
&lt;p&gt;Crystaldiskmark works on network shares, so I tried that.&lt;/p&gt;
&lt;p&gt;8k:&lt;br&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/T-LJg0XmsS-482.avif 482w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/T-LJg0XmsS-482.webp 482w&quot;&gt;&lt;img alt=&quot;8k crystalbenchmark&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/T-LJg0XmsS-482.png&quot; width=&quot;482&quot; height=&quot;352&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;64k:&lt;br&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/qzUq7bzt-Z-482.avif 482w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/qzUq7bzt-Z-482.webp 482w&quot;&gt;&lt;img alt=&quot;64k crystalbenchmark&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/qzUq7bzt-Z-482.png&quot; width=&quot;482&quot; height=&quot;352&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;The speed increase for 1M operations makes sense to me when switching to 64k volblocksize.  The &lt;strong&gt;54%&lt;/strong&gt; speed increase in 4k operations makes less sense to me.  These results align with the benchmarks on the 4 spinning disks in the last post, but they are still surprising to me!&lt;/p&gt;
&lt;h2 id=&quot;what-have-i-learned-so-far&quot; tabindex=&quot;-1&quot;&gt;What have I learned so far? &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-bench2/zfs-volblocksize-round-2/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Well, it&#39;s still pretty confusing.  64k seems to be universally faster than 8k, but probably causes a decent amount of write amplification for small writes typical of VM workloads.&lt;/p&gt;
&lt;p&gt;After all this testing, I am getting interested in possibly moving away from the fileserver-in-a-VM setup.  It has been pretty a pretty elegant solution, being able to backup, restore, and migrate the entire fileserver so quickly and easily.  I think I can still get most of the same functionality with a plain ZFS dataset mounted in a container, using zfs send/receive to back it up to the Proxmox Backup Server.  It can probably be automated pretty easily with a script and be faster and better than what I&#39;m doing.&lt;/p&gt;
&lt;p&gt;This has been pretty fun to learn so far!  Switching up my approach will allow me to learn even more about zfs snapshots and how to manage them. It will also reduce backup and restore times even further.  Currently, the backup server relies on dirty-pages to know which files have changed for each backup.  If the VM has been restarted (or is currently offline), that means it still has to scan the full zvolume!  Excited to set up a container and start testing it soon.&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>Second Brain activated</title>
		<link href="https://stinky.blog/blog/second-brain-activated/"/>
		<updated>2024-03-17T00:00:00Z</updated>
		<id>https://stinky.blog/blog/second-brain-activated/</id>
		<content type="html">&lt;h2 id=&quot;second-brain&quot; tabindex=&quot;-1&quot;&gt;Second Brain &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/second-brain-activated/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;I took calculus in &#39;22.  Today, I wouldn&#39;t be able to find the derivative of a constant.  It&#39;s the same story with many things that I have learned over the years.  New info comes into the brain, old info gets dumped out.  That is something that I would like to change!  I want to remember stuff.&lt;/p&gt;
&lt;p&gt;Since embarking on this career change, information is coming at me at light speed.  Learning new things at work, studying for certifications, taking college classes, and homelabbing has my brain hitting its storage quota.  I would like a way to quickly document things and reference them later.  The method needs to be easy and fun, or else I won&#39;t stick with it.  Enter the second brain.&lt;/p&gt;
&lt;p&gt;After watching &lt;a href=&quot;https://www.youtube.com/watch?v=zIGJ8NTHF4k&amp;amp;t=3731s&quot;&gt;this guy&#39;s video&lt;/a&gt; and looking at &lt;a href=&quot;https://mischavandenburg.com/&quot;&gt;his site&lt;/a&gt;, I decided I want to do something similar.  I don&#39;t need to take it as far as him, but I think it is an awesome idea.&lt;/p&gt;
&lt;h2 id=&quot;markdown&quot; tabindex=&quot;-1&quot;&gt;Markdown &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/second-brain-activated/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;The idea is to simply take notes in markdown format and associate them with tags.  Then, you can search through them instantly using a fuzzy finder.&lt;/p&gt;
&lt;p&gt;Writing the notes in markdown serves a couple of key functions:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;can take notes from the terminal extremely quickly - no excuse not to&lt;/li&gt;
&lt;li&gt;still easy to insert media&lt;/li&gt;
&lt;li&gt;files are tiny&lt;/li&gt;
&lt;li&gt;allows instant conversion to static web pages for my blog&lt;/li&gt;
&lt;li&gt;easily convertible to another format if I stop doing this second brain thing&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;fuzzy-finder&quot; tabindex=&quot;-1&quot;&gt;Fuzzy finder &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/second-brain-activated/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;To search my notes, &lt;a href=&quot;https://github.com/Magnushhoie/fuz&quot;&gt;I will be using fuz&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;launch fuz&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;fuz&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;enter search terms, CTRL+L to view in &lt;strong&gt;less&lt;/strong&gt;, CTRL +O to view in &lt;strong&gt;vim&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;the-blog&quot; tabindex=&quot;-1&quot;&gt;The blog &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/second-brain-activated/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;In addition to using the fuzzy finder to search my notes locally, I want them to be available to me anywhere.  I found my old wordpress blog very handy for looking at my own tutorials to remember how I configured something or linking them to a friend.&lt;/p&gt;
&lt;p&gt;To make that super easy, I just store all the notes in a local github repo on my machine and use eleventy to generate static pages from them, which I explain in &lt;a href=&quot;https://stinky.blog/blog/adios-wordpress/&quot;&gt;this post&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Having to write all the front matter for each new post and then generate the static pages, generate the search index, and then push that to github is a lot of steps for simple note-taking.  So I automated creating a new post &lt;a href=&quot;https://stinky.blog/blog/create-new-post-script/&quot;&gt;with this script&lt;/a&gt; and the page/index generation and github pushing with the script at the &lt;a href=&quot;https://stinky.blog/blog/adios-wordpress/&quot;&gt;bottom of this page&lt;/a&gt;.&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>find</title>
		<link href="https://stinky.blog/blog/rhcsa/find/"/>
		<updated>2024-03-17T00:00:00Z</updated>
		<id>https://stinky.blog/blog/rhcsa/find/</id>
		<content type="html">&lt;h2 id=&quot;basic-usage&quot; tabindex=&quot;-1&quot;&gt;Basic usage &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/find/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;where&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;options&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;what&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;find all mp3 files in /mnt/media:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt; /mnt/media &lt;span class=&quot;token parameter variable&quot;&gt;-name&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;*.mp3&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;-type f = files,  d = directories&lt;/p&gt;
&lt;p&gt;mute errors for searching /:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt; / &lt;span class=&quot;token parameter variable&quot;&gt;-name&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;hosts&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;2&lt;/span&gt;&gt;&lt;/span&gt; /dev/null&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;extra-options&quot; tabindex=&quot;-1&quot;&gt;Extra options &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/find/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;find files modified within the last X days:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt; /var/log &lt;span class=&quot;token parameter variable&quot;&gt;-type&lt;/span&gt; f &lt;span class=&quot;token parameter variable&quot;&gt;-mtime&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-1&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;find files modified more than X days ago:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt; /var/log &lt;span class=&quot;token parameter variable&quot;&gt;-type&lt;/span&gt; f &lt;span class=&quot;token parameter variable&quot;&gt;-mtime&lt;/span&gt; +30&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;find files of a certain size (+/-):&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt; /mnt/media &lt;span class=&quot;token parameter variable&quot;&gt;-type&lt;/span&gt; f &lt;span class=&quot;token parameter variable&quot;&gt;-size&lt;/span&gt; +1G&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;find files by permissions:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt; /home &lt;span class=&quot;token parameter variable&quot;&gt;-type&lt;/span&gt; f &lt;span class=&quot;token parameter variable&quot;&gt;-perm&lt;/span&gt; 0777&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;executing-commands-on-files&quot; tabindex=&quot;-1&quot;&gt;Executing commands on files &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/find/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;find files and move them somewhere:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-type&lt;/span&gt; f &lt;span class=&quot;token parameter variable&quot;&gt;-name&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;*.md&quot;&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-exec&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; ~/notes/ &lt;span class=&quot;token punctuation&quot;&gt;&#92;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;{} = placeholder for what find is finding
; = ; ends the command, needs escape character&lt;/p&gt;
&lt;p&gt;use xargs instead of exec:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt; /etc &lt;span class=&quot;token parameter variable&quot;&gt;-type&lt;/span&gt; f &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;xargs&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;2&lt;/span&gt;&gt;&lt;/span&gt; /dev/null&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;xargs will batch the input before executing, -exec will run the command once for each input item&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>Bash config</title>
		<link href="https://stinky.blog/blog/bash-config/"/>
		<updated>2024-03-17T00:00:00Z</updated>
		<id>https://stinky.blog/blog/bash-config/</id>
		<content type="html">&lt;h2 id=&quot;global-vs-user&quot; tabindex=&quot;-1&quot;&gt;Global vs user &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/bash-config/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Global configs in /etc affect all users.  Includes /etc/profile and /etc/bash.bashrc&lt;/p&gt;
&lt;p&gt;/etc/profile is not bash specific -- contains system-wide environment variables and startup config for login shells&lt;/p&gt;
&lt;p&gt;/etc/bash.bashrc is the global config for non-login bash shells.&lt;/p&gt;
&lt;p&gt;User-specific configs are located in the users home folder -- .bashrc and .bash_profile&lt;/p&gt;
&lt;p&gt;These are copied from /etc/skel upon user creation&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>Shell expansion</title>
		<link href="https://stinky.blog/blog/rhcsa/shell-expansion/"/>
		<updated>2024-03-16T00:00:00Z</updated>
		<id>https://stinky.blog/blog/rhcsa/shell-expansion/</id>
		<content type="html">&lt;h2 id=&quot;globbing&quot; tabindex=&quot;-1&quot;&gt;Globbing &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/shell-expansion/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Expand filenames with wildcards.  * represents any pattern.  ? represents any single character.&lt;/p&gt;
&lt;p&gt;list everything:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; *&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;list things that start with &amp;quot;a&amp;quot; and are at least 2 characters long:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; a?*&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;list things that begin with lowercase a - e:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;a-e&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;*&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;braces&quot; tabindex=&quot;-1&quot;&gt;Braces &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/shell-expansion/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Perform this action on 1 through 9:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;touch&lt;/span&gt; file&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Perform this action on all these terms:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;useradd&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;lisa,linda,anna&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;substitution&quot; tabindex=&quot;-1&quot;&gt;Substitution &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/shell-expansion/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Search for the output of the command:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-l&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;which&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Use variable contents in command:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$PATH&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
</content>
	</entry>
	
	<entry>
		<title>Shell escaping</title>
		<link href="https://stinky.blog/blog/rhcsa/shell-escaping/"/>
		<updated>2024-03-16T00:00:00Z</updated>
		<id>https://stinky.blog/blog/rhcsa/shell-escaping/</id>
		<content type="html">&lt;p&gt;Special characters must be escaped to prevent the shell from interpreting them as part of the script/command.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Double quotes&lt;/strong&gt; &amp;quot;...&amp;quot; suppress globbing and shell expansion but still allow command and variable substitutions.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Single quotes&lt;/strong&gt; &#39;...&#39; suppress all special characters.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Backslashes&lt;/strong&gt; &amp;quot; &#92; &amp;quot; suppress only the character following the slash.&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>Create New Post script</title>
		<link href="https://stinky.blog/blog/create-new-post-script/"/>
		<updated>2024-03-11T00:00:00Z</updated>
		<id>https://stinky.blog/blog/create-new-post-script/</id>
		<content type="html">&lt;h2 id=&quot;quickly-create-new-posts&quot; tabindex=&quot;-1&quot;&gt;Quickly create new posts &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/create-new-post-script/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Made this little script to generate the front matter for new blog posts and open them in the editor.  Estimated to save dozens of seconds over the course of my lifetime&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;#gather post info&lt;/span&gt;

&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Post title?&quot;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;read&lt;/span&gt; title

&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Post description?&quot;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;read&lt;/span&gt; description

&lt;span class=&quot;token assign-left variable&quot;&gt;current_date&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;date&lt;/span&gt; +%Y-%m-%d&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Post tags? (one or more, comma separated, like, this)&quot;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;read&lt;/span&gt; tags

&lt;span class=&quot;token comment&quot;&gt;#clean up tags&lt;/span&gt;

&lt;span class=&quot;token assign-left variable&quot;&gt;tidytags&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; $tags &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;s/, /&lt;span class=&quot;token entity&quot; title=&quot;&#92;&#92;&quot;&gt;&#92;&#92;&lt;/span&gt;n  - /g&quot;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;#generate post metadata&lt;/span&gt;

&lt;span class=&quot;token assign-left variable&quot;&gt;fmatter&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;---
title: &lt;span class=&quot;token entity&quot; title=&quot;&#92;&amp;quot;&quot;&gt;&#92;&quot;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$title&lt;/span&gt;&lt;span class=&quot;token entity&quot; title=&quot;&#92;&amp;quot;&quot;&gt;&#92;&quot;&lt;/span&gt;
description: &lt;span class=&quot;token entity&quot; title=&quot;&#92;&amp;quot;&quot;&gt;&#92;&quot;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$description&lt;/span&gt;&lt;span class=&quot;token entity&quot; title=&quot;&#92;&amp;quot;&quot;&gt;&#92;&quot;&lt;/span&gt;
date: &lt;span class=&quot;token variable&quot;&gt;$current_date&lt;/span&gt;
tags:
  - &lt;span class=&quot;token variable&quot;&gt;$tidytags&lt;/span&gt;
---
&quot;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#convert title to filename&lt;/span&gt;

&lt;span class=&quot;token assign-left variable&quot;&gt;filename&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; $title &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tr&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;[:upper:]&#39;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;[:lower:]&#39;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tr&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39; &#39;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&#39;-&#39;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;.md

&lt;span class=&quot;token comment&quot;&gt;#write metadata to filename&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$fmatter&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./content/blog/&lt;span class=&quot;token variable&quot;&gt;$filename&lt;/span&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;#open vim @ filename&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;vim&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;./content/blog/&lt;span class=&quot;token variable&quot;&gt;$filename&lt;/span&gt;&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
</content>
	</entry>
	
	<entry>
		<title>vim</title>
		<link href="https://stinky.blog/blog/rhcsa/vim/"/>
		<updated>2024-03-10T00:00:00Z</updated>
		<id>https://stinky.blog/blog/rhcsa/vim/</id>
		<content type="html">&lt;p&gt;&lt;strong&gt;vimtutor&lt;/strong&gt; to launch tutorial&lt;/p&gt;
&lt;h2 id=&quot;general&quot; tabindex=&quot;-1&quot;&gt;General &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/vim/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Starts in &lt;strong&gt;command mode&lt;/strong&gt;, press &lt;strong&gt;i&lt;/strong&gt; for &lt;strong&gt;insert mode&lt;/strong&gt; or &lt;strong&gt;a&lt;/strong&gt; for &lt;strong&gt;append mode&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Escape to re-enter command mode&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;:w&lt;/strong&gt; --  Save file&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;:q&lt;/strong&gt; -- Quit&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;:wq&lt;/strong&gt; -- Save and quit&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;:q!&lt;/strong&gt; --  Quit without saving&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;o&lt;/strong&gt; -- enters insert mode on a new line&lt;/p&gt;
&lt;h2 id=&quot;text-operations&quot; tabindex=&quot;-1&quot;&gt;Text Operations &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/vim/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;dd&lt;/strong&gt; -- delete current line&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;yy&lt;/strong&gt; -- copy current line&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;p&lt;/strong&gt; -- paste current line&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;u&lt;/strong&gt; -- undo&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ctrl+r&lt;/strong&gt; -- redo&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;:%s/oldword/newword/g&lt;/strong&gt; -- substitute phrase -- /g = all instances&lt;/p&gt;
&lt;h2 id=&quot;visual-mode&quot; tabindex=&quot;-1&quot;&gt;Visual mode &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/vim/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;v&lt;/strong&gt; --  enter visual mode&lt;/p&gt;
&lt;p&gt;highlight text starting from current cursor position then copy/paste/delete/etc&lt;/p&gt;
&lt;h2 id=&quot;navigate&quot; tabindex=&quot;-1&quot;&gt;Navigate &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/vim/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;gg&lt;/strong&gt; -- top of document&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;G&lt;/strong&gt; -- end of document&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;/word&lt;/strong&gt; -- search for &amp;quot;word&amp;quot;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;?word&lt;/strong&gt; -- search backwards for &amp;quot;word&amp;quot;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;^&lt;/strong&gt; -- move to beginning of line&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;$&lt;/strong&gt; -- move to end of line&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;w&lt;/strong&gt; -- move to next word&lt;/p&gt;
&lt;h2 id=&quot;display&quot; tabindex=&quot;-1&quot;&gt;Display &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/vim/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;:se numbers&lt;/strong&gt; -- show line numbers&lt;/p&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;this page written proudly in nano&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
</content>
	</entry>
	
	<entry>
		<title>stdin, stdout, stderr</title>
		<link href="https://stinky.blog/blog/rhcsa/stds/"/>
		<updated>2024-03-10T00:00:00Z</updated>
		<id>https://stinky.blog/blog/rhcsa/stds/</id>
		<content type="html">&lt;h2 id=&quot;redirection&quot; tabindex=&quot;-1&quot;&gt;Redirection &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/stds/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Write (or overwrite) stdout to file:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;thing &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; place&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Append stdout to file:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;thing &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; place&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Write/append errors to a file:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;thing &lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;2&lt;/span&gt;&gt;&lt;/span&gt; or &lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;2&lt;/span&gt;&gt;&gt;&lt;/span&gt; place&lt;/code&gt;&lt;/pre&gt;
</content>
	</entry>
	
	<entry>
		<title>man</title>
		<link href="https://stinky.blog/blog/rhcsa/man/"/>
		<updated>2024-03-10T00:00:00Z</updated>
		<id>https://stinky.blog/blog/rhcsa/man/</id>
		<content type="html">&lt;h2 id=&quot;sections&quot; tabindex=&quot;-1&quot;&gt;Sections &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/man/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;executables / shell cmds&lt;/li&gt;
&lt;li&gt;system calls&lt;/li&gt;
&lt;li&gt;library calls&lt;/li&gt;
&lt;li&gt;special files (/dev)&lt;/li&gt;
&lt;li&gt;file formats / conventions&lt;/li&gt;
&lt;li&gt;games&lt;/li&gt;
&lt;li&gt;misc&lt;/li&gt;
&lt;li&gt;sys admin / root&lt;/li&gt;
&lt;li&gt;kernel routines&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;To search for a command in a particular section, &lt;strong&gt;man # command&lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;man&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;passwd&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;man returns the first section number for a given command.  to see all sections:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;man&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-a&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;passwd&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;navigation&quot; tabindex=&quot;-1&quot;&gt;Navigation &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/man/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Use / to search&lt;/p&gt;
&lt;p&gt;spacebar / pgdown / pgup to scroll&lt;/p&gt;
&lt;h2 id=&quot;searching&quot; tabindex=&quot;-1&quot;&gt;Searching &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/man/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Search the NAME field:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;man&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-k&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;keyword&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;or&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apropos&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;keyword&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;n for next result, p for previous&lt;/p&gt;
&lt;h2 id=&quot;mandb&quot; tabindex=&quot;-1&quot;&gt;mandb &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/man/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Search index needs to be built  with &lt;strong&gt;mandb&lt;/strong&gt; command (cronjob or manually)&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; mandb&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;search returns &amp;quot;nothing appropriate&amp;quot; ? run &lt;strong&gt;mandb&lt;/strong&gt;&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>bash shortcuts</title>
		<link href="https://stinky.blog/blog/rhcsa/bash-shortcuts/"/>
		<updated>2024-03-10T00:00:00Z</updated>
		<id>https://stinky.blog/blog/rhcsa/bash-shortcuts/</id>
		<content type="html">&lt;h2 id=&quot;ctrl&quot; tabindex=&quot;-1&quot;&gt;Ctrl &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/bash-shortcuts/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Shortcut&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ctrl + D&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;End of file&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ctrl + C&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Interrupt a command&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ctrl + Z&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Suspend a command&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ctrl + A&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Move to start of line&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ctrl + E&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Move to end of line&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ctrl + K&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Cut text to end of line&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ctrl + U&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Cut text to start of line&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ctrl + Y&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Paste the last cut text&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ctrl + R&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Search history backwards&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ctrl + L&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Clear the screen&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&quot;alt&quot; tabindex=&quot;-1&quot;&gt;Alt &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/bash-shortcuts/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Shortcut&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + b&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Move back one word&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + f&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Move forward one word&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + d&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Delete word right of the cursor&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + Backspace&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Delete word left of the cursor&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + &amp;lt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Move to the beginning of the history&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + &amp;gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Move to the end of the history&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + t&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Swap the current word with the previous&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + u&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Uppercase word from cursor to end of word&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + l&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Lowercase word from cursor to end of word&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + c&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Capitalize the word&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + r&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Revert any changes to a command you&#39;ve pulled from history&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</content>
	</entry>
	
	<entry>
		<title>bash history</title>
		<link href="https://stinky.blog/blog/rhcsa/bash-history/"/>
		<updated>2024-03-10T00:00:00Z</updated>
		<id>https://stinky.blog/blog/rhcsa/bash-history/</id>
		<content type="html">&lt;h2 id=&quot;history&quot; tabindex=&quot;-1&quot;&gt;History &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/bash-history/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;bash keeps all recently used commands in ~./bash_history&lt;/p&gt;
&lt;p&gt;To see all recently used bash commands:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;history&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Ctrl + r&lt;/strong&gt; To search history&lt;/p&gt;
&lt;p&gt;To repeat a command by its line # on &#39;history&#39;:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;nn&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Repeat last command that starts with letter a:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;a&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Repeat last command with sudo:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;history-settings&quot; tabindex=&quot;-1&quot;&gt;History settings &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/bash-history/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Set two environment variables $HISTSIZE and $HISTFILESIZE&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;500&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$HISTSIZE&lt;/span&gt; or &lt;span class=&quot;token environment constant&quot;&gt;$HISTFILESIZE&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;to make permanent, add to ~/.bashrc&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;&lt;span class=&quot;token environment constant&quot;&gt;HISTFILESIZE&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;500&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;&lt;span class=&quot;token environment constant&quot;&gt;HISTSIZE&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;500&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Write current history to history file:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;history&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-w&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Clear current history:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;history&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-c&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Clear specific line:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;history&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-d&lt;/span&gt; nn&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;History file is not merged until terminal exit&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>ZFS Volblocksize for VM Workloads</title>
		<link href="https://stinky.blog/blog/zfs-bench/"/>
		<updated>2024-03-06T00:00:00Z</updated>
		<id>https://stinky.blog/blog/zfs-bench/</id>
		<content type="html">&lt;p&gt;I store all of my VMs on ZFS pools.  On Proxmox, VMs stored on ZFS pools will use zvols by default, rather than a disk file in a dataset. Proxmox zvols use a default volblocksize of 8k.  What the heck is a zvol, and what is the impact on storage performance?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Zvols&lt;/strong&gt; present a virtual block device to the VM, like a physical disk.  It sounds pretty cool, but it comes with some caveats.  Zvols use a &lt;em&gt;volblocksize&lt;/em&gt; rather than a recordsize or a block size.  Selecting the wrong volblocksize for your workload can result in extreme write amplification, increased drive wear, and terrible performance.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Volblocksize&lt;/strong&gt; represents the &lt;em&gt;minimum&lt;/em&gt; amount of data that can be written to a zvol.  This is the opposite of recordsize, which refers to the maximum.  Writing a 1kb file to a zpool with a recordsize of 128k is no problem -- ZFS will simply write 1k. The same 1k write on a zvol with volblocksize of 128k will cause 128k of data to be written.  That&#39;s a write amplification of &lt;strong&gt;128x&lt;/strong&gt;.  No bueno!&lt;/p&gt;
&lt;p&gt;A similar situation occurs in reverse.  You have a 128k volblocksize and you need to read 1k.  ZFS must read the whole 128k block to return your 1k data.  This can greatly increase latency and reduce IOPs.&lt;/p&gt;
&lt;p&gt;It gets even worse if you&#39;re calculating parity -- arrays with certain drive configurations can lose 50% or more of their total usable space to metadata when block size is set too low.  Look for posts discussing &amp;quot;padding overhead&amp;quot; or &lt;a href=&quot;https://www.delphix.com/blog/zfs-raidz-stripe-width-or-how-i-learned-stop-worrying-and-love-raidz&quot;&gt;posts like this&lt;/a&gt; for more info.&lt;/p&gt;
&lt;p&gt;I was hoping that the perfect volblocksize would be just a google search away... but it looks like it&#39;s gonna be more complicated than that!  The volblocksize should precisely match the workload, 16k for databases which perform 16k writes, for example.  I&#39;m not sure exactly what that would be for my typical usage.  So, my goal here is to just to learn what I can about how ZFS interacts with zvols, starting with some simple tests.&lt;/p&gt;
&lt;h2 id=&quot;testing-methodology-round-1&quot; tabindex=&quot;-1&quot;&gt;Testing Methodology - Round 1 &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-bench/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;I&#39;ll be using a striped mirror containing 4x 12TB drives.  The underlying pool has ashift=12, compression=LZ4, recordsize=128k.  I am testing inside a Debian VM with ext4 filesystem, 4k blocks, cache=none.&lt;/p&gt;
&lt;p&gt;To test each volblocksize, I am simply moving the virtual disk off of the pool, resetting the volblocksize, and then moving the virtual disk back to the pool.  (The data needs to be written again in order for the new volblocksize to take effect.)&lt;/p&gt;
&lt;p&gt;For round one, I would like to find the extremes -- just to get some idea of the relationship between these values.&lt;/p&gt;
&lt;p&gt;First, I used fio to test random writes of 4k and 1M blocks at queue depth 1.  I ran both tests on volblocksizes 8k, 16k, 32k, and 64k. sync=disabled&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;fio &lt;span class=&quot;token parameter variable&quot;&gt;--name&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;random-write &lt;span class=&quot;token parameter variable&quot;&gt;--ioengine&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;posixaio &lt;span class=&quot;token parameter variable&quot;&gt;--rw&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;randwrite &lt;span class=&quot;token parameter variable&quot;&gt;--bs&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1M &lt;span class=&quot;token parameter variable&quot;&gt;--size&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;4g &lt;span class=&quot;token parameter variable&quot;&gt;--numjobs&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--iodepth&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--runtime&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;60&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--time_based&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--end_fsync&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;br&gt;
&lt;h2 id=&quot;4k-random-writes&quot; tabindex=&quot;-1&quot;&gt;4k random writes: &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-bench/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Volblocksize&lt;/th&gt;
&lt;th&gt;Block Size&lt;/th&gt;
&lt;th&gt;IOPS&lt;/th&gt;
&lt;th&gt;Bandwidth (MiB/s)&lt;/th&gt;
&lt;th&gt;Average Latency (μs)&lt;/th&gt;
&lt;th&gt;99th Percentile Latency (μs)&lt;/th&gt;
&lt;th&gt;Disk Utilization (%)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;8K&lt;/td&gt;
&lt;td&gt;4K&lt;/td&gt;
&lt;td&gt;15.7k&lt;/td&gt;
&lt;td&gt;61.2&lt;/td&gt;
&lt;td&gt;41.74&lt;/td&gt;
&lt;td&gt;99&lt;/td&gt;
&lt;td&gt;86.15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;16K&lt;/td&gt;
&lt;td&gt;4K&lt;/td&gt;
&lt;td&gt;18.1k&lt;/td&gt;
&lt;td&gt;70.8&lt;/td&gt;
&lt;td&gt;32.89&lt;/td&gt;
&lt;td&gt;93&lt;/td&gt;
&lt;td&gt;78.41&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;32K&lt;/td&gt;
&lt;td&gt;4K&lt;/td&gt;
&lt;td&gt;19.7k&lt;/td&gt;
&lt;td&gt;76.8&lt;/td&gt;
&lt;td&gt;33.55&lt;/td&gt;
&lt;td&gt;105&lt;/td&gt;
&lt;td&gt;79.44&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;64K&lt;/td&gt;
&lt;td&gt;4K&lt;/td&gt;
&lt;td&gt;25.1k&lt;/td&gt;
&lt;td&gt;97.9&lt;/td&gt;
&lt;td&gt;35.81&lt;/td&gt;
&lt;td&gt;126&lt;/td&gt;
&lt;td&gt;55.38&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;These results were surprising to me!  Switching from 8k to 64k volblocksize, we see a 60% increase in throughput and a huge drop in iowait.  There is a 60% increase in IOPs, as well.&lt;/p&gt;
&lt;p&gt;I will have to run some more detailed tests here, but I suspect these huge gains may come with huge penalties in other areas.  Namely, random reads that miss the ARC, or writes that require read/modify/write.  Will have to figure out how to test that later.&lt;/p&gt;
&lt;br&gt;  
&lt;h2 id=&quot;1m-random-writes&quot; tabindex=&quot;-1&quot;&gt;1M random writes: &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-bench/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Volblocksize&lt;/th&gt;
&lt;th&gt;Block Size&lt;/th&gt;
&lt;th&gt;IOPS&lt;/th&gt;
&lt;th&gt;Bandwidth (MiB/s)&lt;/th&gt;
&lt;th&gt;Average Latency (μs)&lt;/th&gt;
&lt;th&gt;99th Percentile Latency (μs)&lt;/th&gt;
&lt;th&gt;Disk Utilization (%)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;8K&lt;/td&gt;
&lt;td&gt;1M&lt;/td&gt;
&lt;td&gt;163&lt;/td&gt;
&lt;td&gt;164&lt;/td&gt;
&lt;td&gt;3136.59&lt;/td&gt;
&lt;td&gt;217056&lt;/td&gt;
&lt;td&gt;93.79&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;16K&lt;/td&gt;
&lt;td&gt;1M&lt;/td&gt;
&lt;td&gt;177&lt;/td&gt;
&lt;td&gt;178&lt;/td&gt;
&lt;td&gt;3638.31&lt;/td&gt;
&lt;td&gt;125305&lt;/td&gt;
&lt;td&gt;90.54&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;32K&lt;/td&gt;
&lt;td&gt;1M&lt;/td&gt;
&lt;td&gt;311&lt;/td&gt;
&lt;td&gt;312&lt;/td&gt;
&lt;td&gt;2207.24&lt;/td&gt;
&lt;td&gt;143655&lt;/td&gt;
&lt;td&gt;89.67&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;64K&lt;/td&gt;
&lt;td&gt;1M&lt;/td&gt;
&lt;td&gt;338&lt;/td&gt;
&lt;td&gt;339&lt;/td&gt;
&lt;td&gt;1933.32&lt;/td&gt;
&lt;td&gt;43779&lt;/td&gt;
&lt;td&gt;93.11&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Same story here!  106% increase in random write speed switching from 8k volblocksize to 64k.   107% increase in IOPs.  Much larger reduction in disk latency here than in the 4k tests.&lt;/p&gt;
&lt;p&gt;I would bet we get the same trade-off here, issues with small random reads and modifying files in place.  Someone give me a trail of breadcrumbs for how to test that!&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/2gS10ltJ7R-594.avif 594w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/2gS10ltJ7R-594.webp 594w&quot;&gt;&lt;img alt=&quot;line graph&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/2gS10ltJ7R-594.jpeg&quot; width=&quot;594&quot; height=&quot;319&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;Looking forward to round 2.  Next time, I&#39;d like to find a way to see how much amplification is going on here, as well as how badly this is affecting reads outside of ARC.&lt;/p&gt;
&lt;p&gt;Would love some feedback on my methodology and some pointers!  More fun to learn with friends.  brianm88 @ gmail.com or /dev/goat on Steam.&lt;/p&gt;
&lt;p&gt;Thanks for reading.  Happy homelabbing!&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>Building a better backup server</title>
		<link href="https://stinky.blog/blog/backup-server/backup-server-build/"/>
		<updated>2024-03-05T00:00:00Z</updated>
		<id>https://stinky.blog/blog/backup-server/backup-server-build/</id>
		<content type="html">&lt;p&gt;It&#39;s always exciting to get new homelab stuff!  Here&#39;s what I&#39;ve been up to.&lt;/p&gt;
&lt;p&gt;My old Proxmox Backup Server has been running on a Thinkpad x270 with a 5TB external USB drive for a little over a year now.  It is installed alongside the hypervisor, with ZFS on the datastore.  It&#39;s been working great!  Backup times were not &lt;em&gt;that&lt;/em&gt; bad, but restore times were really slow.&lt;/p&gt;
&lt;p&gt;I still use that node as a secondary backup server, which will clone the primary backup datastore daily.  I plan to move it to my mom&#39;s house and leave it connected via tailscale as part of my little &amp;quot;3-2-1&amp;quot; backup plan.&lt;/p&gt;
&lt;p&gt;I wanted to build a better, faster PBS server that can also double as a robust Proxmox node for other tasks.  I also wanted to do it cheap!  So I started hunting on ebay...&lt;/p&gt;
&lt;h2 id=&quot;the-new-server&quot; tabindex=&quot;-1&quot;&gt;The new server &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/backup-server/backup-server-build/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;You already know I bought another Thinkstation.&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/zzH1bw69e7-400.avif 400w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/zzH1bw69e7-400.webp 400w&quot;&gt;&lt;img alt=&quot;Thinkstation P320&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/zzH1bw69e7-400.jpeg&quot; width=&quot;400&quot; height=&quot;533&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;I bought a P320 Tower, little brother to the P330 SFF I already have. It came with an i7-7700k, 512gb nvme, and 32gb of ddr4.&lt;/p&gt;
&lt;p&gt;Here are the parts I was able to get and the prices:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Quantity&lt;/th&gt;
&lt;th&gt;Item&lt;/th&gt;
&lt;th&gt;Price&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;Thinkstation P320&lt;/td&gt;
&lt;td&gt;$163&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;12TB Toshiba MG07ACA12TEY (new)&lt;/td&gt;
&lt;td&gt;$100/each&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;12TB WD HUH721212AL (used)&lt;/td&gt;
&lt;td&gt;$90/each&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;32GB Timetec ddr4 2600&lt;/td&gt;
&lt;td&gt;$50&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;10gbe Intel X520 nic&lt;/td&gt;
&lt;td&gt;$20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;Orico hot swap bay adapter 5.25&amp;quot;&lt;/td&gt;
&lt;td&gt;$18&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;---&lt;/td&gt;
&lt;td&gt;---&lt;/td&gt;
&lt;td&gt;---&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Total&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;$649&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;So for less than the cost of a decent NAS with no disks, I was able to get 48TBs, 10gbe, 64gb ram and a fairly strong kaby lake cpu.  One day when we reach a post-scarcity society, I&#39;ll swap to ECC memory and get more flash storage.&lt;/p&gt;
&lt;h2 id=&quot;hardware&quot; tabindex=&quot;-1&quot;&gt;Hardware &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/backup-server/backup-server-build/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Both the &amp;quot;new&amp;quot; drives and the &amp;quot;used&amp;quot; drives came in Dell hotswap bays, which I had to remove.&lt;br&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/u6qDAQKe0l-400.avif 400w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/u6qDAQKe0l-400.webp 400w&quot;&gt;&lt;img alt=&quot;Dell drive caddy&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/u6qDAQKe0l-400.jpeg&quot; width=&quot;400&quot; height=&quot;533&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;This case only has 2 slots for 3.5&amp;quot; drives, so I slipped the little plastic Lenovo caddy on two of them.&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/DOZ-EKQ58A-400.avif 400w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/DOZ-EKQ58A-400.webp 400w&quot;&gt;&lt;img alt=&quot;Lenovo drive caddy&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/DOZ-EKQ58A-400.jpeg&quot; width=&quot;400&quot; height=&quot;300&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;For the other two drives, I used the two hotswap bays from Amazon.  Very cool little devices for $18!&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/6h_VGyvyih-400.avif 400w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/6h_VGyvyih-400.webp 400w&quot;&gt;&lt;img alt=&quot;Hot swap bay&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/6h_VGyvyih-400.jpeg&quot; width=&quot;400&quot; height=&quot;300&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;Pretty tidy!  There is a garbage SSD free-floating around in there.  We&#39;ll chat more about that in the ZFS optimization post. (Foreshadowing:  awful SSDs make awful SLOG/L2Arc devices)&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/6T6z6DWQvc-400.avif 400w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/6T6z6DWQvc-400.webp 400w&quot;&gt;&lt;img alt=&quot;Server internals with drives hooked up&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/6T6z6DWQvc-400.jpeg&quot; width=&quot;400&quot; height=&quot;300&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;It looks pretty awesome with the drive bays now!  The lights are REALLY bright though, if that&#39;s not your thing.  Blue when powered on, red for activity.  It&#39;s like a police raid when the backups are running.&lt;/p&gt;
&lt;p&gt;Excuse the wires, had to plug in a monitor to troubleshoot (network cable was plugged into wrong port):&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/8xnhi5QQGN-400.avif 400w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/8xnhi5QQGN-400.webp 400w&quot;&gt;&lt;img alt=&quot;Server rack with backup server installed&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/8xnhi5QQGN-400.jpeg&quot; width=&quot;400&quot; height=&quot;533&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;h2 id=&quot;initial-config&quot; tabindex=&quot;-1&quot;&gt;Initial config &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/backup-server/backup-server-build/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Pretty simple, just slapped Proxmox on it, installed Proxmox Backup Server alongside it.&lt;/p&gt;
&lt;p&gt;The ZFS pool is setup as a striped mirror, with two drives in each vdev. Ashift=12, compression=LZ4, recordsize=1M.&lt;/p&gt;
&lt;h2 id=&quot;first-impressions&quot; tabindex=&quot;-1&quot;&gt;First impressions &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/backup-server/backup-server-build/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/mtuSOuIa1e-400.avif 400w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/mtuSOuIa1e-400.webp 400w&quot;&gt;&lt;img alt=&quot;Backup speed&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/mtuSOuIa1e-400.jpeg&quot; width=&quot;400&quot; height=&quot;290&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;Backups and restores are roughly ~10x faster!  Old backup server would write at about ~20MB/s.  Now backups are writing at 250MB/s+.  Reads are obviously much higher (~20 seconds to restore average 32GB linux VMs).  Live restores work great.  This node also has 8 times as much memory as the old x270 has, so I&#39;m able to run a lot more VMs on it as well.  Pretty good deal!&lt;/p&gt;
&lt;p&gt;Very excited to delve deeper into ZFS and start testing my workload and optimizing the pool settings.&lt;/p&gt;
&lt;p&gt;I have been messing with recordsizes, volblocksizes, SLOG devices, and L2arc already!  The next post will contain some of my findings.&lt;/p&gt;
&lt;p&gt;Happy homelabbing!&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>Adios Wordpress?</title>
		<link href="https://stinky.blog/blog/adios-wordpress/"/>
		<updated>2024-03-03T00:00:00Z</updated>
		<id>https://stinky.blog/blog/adios-wordpress/</id>
		<content type="html">&lt;p&gt;Welcome to my first post on a static site.  Wordpress has been super cool, but I really wanted to try out something simpler and easier to deploy from the commandline.&lt;/p&gt;
&lt;p&gt;It has been a blast hosting the blog on the VPS and learning the ins-and-outs of securing the server, managing the certificates, and general wordpress admin stuff.  Wordpress plugins have been very awesome and easy to use, even the free ones.  However, it&#39;s just a ton of functionality that I don&#39;t really need.&lt;/p&gt;
&lt;p&gt;I watched a couple of youtube videos about hosting static sites on github pages with jekyll and other static site generators.  That led me to trying out a few of them before landing on this one, eleventy.&lt;/p&gt;
&lt;p&gt;To get this running, I created a github repository: username.github.io&lt;/p&gt;
&lt;p&gt;Then, I cloned the repo to my home folder&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone https://github.com/brianm88/brianm88.github.io&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I used this eleventy template: &lt;a href=&quot;https://github.com/11ty/eleventy-base-blog&quot;&gt;eleventy-base-blog&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Cloned those files to my github folder and ran eleventy:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;npx @11ty/eleventy &lt;span class=&quot;token parameter variable&quot;&gt;--serve&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;There I had a working skeleton!  But, I wanted a search bar.  So I found a solution with pagefind: &lt;a href=&quot;https://pagefind.app/&quot;&gt;pagefind&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Pretty much just need to insert this line into one of the pages to get it working.  In my case, inserted it in to /my-repo/_includes/layouts/home.njk&lt;/p&gt;
&lt;pre class=&quot;language-http&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-http&quot;&gt;&amp;lt;link href=&quot;/pagefind/pagefind-ui.css&quot; rel=&quot;stylesheet&quot;&gt;
&amp;lt;script src=&quot;/pagefind/pagefind-ui.js&quot;&gt;&amp;lt;/script&gt;
&amp;lt;div id=&quot;search&quot;&gt;&amp;lt;/div&gt;
&amp;lt;script&gt;
    window.addEventListener(&#39;DOMContentLoaded&#39;, (event) =&gt; {
        new PagefindUI({ element: &quot;#search&quot;, showSubResults: true });
    });
&amp;lt;/script&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then, you need to run the indexer to let it build an index of your site files.&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;npx &lt;span class=&quot;token parameter variable&quot;&gt;-y&lt;/span&gt; pagefind &lt;span class=&quot;token parameter variable&quot;&gt;--site&lt;/span&gt; _site&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then I had some weird issues getting github pages to let me select the right folder.  So, I created a /docs/ folder like they suggest, and I just rsynced the stuff into it.  I wrote this into a script so I can execute all this in one command.  The script also takes a commit comment and pushes to github:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash&lt;/span&gt;

&lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 11ty build&lt;/span&gt;
npx @11ty/eleventy

&lt;span class=&quot;token comment&quot;&gt;# pagefind build index&lt;/span&gt;
npx &lt;span class=&quot;token parameter variable&quot;&gt;-y&lt;/span&gt; pagefind &lt;span class=&quot;token parameter variable&quot;&gt;--site&lt;/span&gt; _site/

&lt;span class=&quot;token comment&quot;&gt;# rsync to gitpages folder&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;rsync&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-arui&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--delete&lt;/span&gt; _site/ docs

&lt;span class=&quot;token comment&quot;&gt;# Prompt for commit message&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Enter commit message:&quot;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;read&lt;/span&gt; commit_message

&lt;span class=&quot;token comment&quot;&gt;# git operations&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; docs
&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; commit &lt;span class=&quot;token parameter variable&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$commit_message&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; push &lt;span class=&quot;token parameter variable&quot;&gt;-u&lt;/span&gt; origin main&lt;/code&gt;&lt;/pre&gt;
</content>
	</entry>
	
	<entry>
		<title>Reducing power consumption of Proxmox nodes</title>
		<link href="https://stinky.blog/blog/pmx-power-consumption/"/>
		<updated>2023-09-07T00:00:00Z</updated>
		<id>https://stinky.blog/blog/pmx-power-consumption/</id>
		<content type="html">&lt;p&gt;I noticed the other day that my proxmox nodes are running at max turbo frequency all the time. Even when there is virtually zero activity, the 8700 and 7700k are sitting at 4.2ghz+ on all cores. The little x270 stays locked at 3.4ghz on its two cores. Since these servers idle a huge amount, they really don’t need to be at max turbo constantly. I saw it recommended on the Proxmox forum to change the cpu governor. Does it work?&lt;/p&gt;
&lt;h2 id=&quot;let-s-measure-the-power-consumption&quot; tabindex=&quot;-1&quot;&gt;Let&#39;s measure the power consumption. &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/pmx-power-consumption/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;First, we need to install linux-cpupower&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; linux-cpupower&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then we can run turbostat to get a rough idea:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;turbostat –quiet –show Package,Busy%,Bzy_MHz,PkgTmp,PkgWatt,CoreTmp –interval &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;With the default governor, my i7-8700 was idling at around ~8.2 watts according to &amp;quot;PkgWatt&amp;quot;.&lt;/p&gt;
&lt;h2 id=&quot;let-s-change-the-cpu-governor&quot; tabindex=&quot;-1&quot;&gt;Let&#39;s change the cpu governor &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/pmx-power-consumption/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Changing the governor is pretty easy:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; “powersave” &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tee&lt;/span&gt; /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now run the turbostat command again to see how the cpu frequency and power consumption have changed.&lt;/p&gt;
&lt;p&gt;My i7-8700 is now idling around ~2.9 watts according to &amp;quot;PkgWatt&amp;quot;.&lt;/p&gt;
&lt;p&gt;Pretty nice reductions! Haven’t noticed any changes in performance for my normal services, since the turbo just ramps back up as expected when you apply a load.&lt;/p&gt;
&lt;p&gt;You can revert the change back to default easily:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; “performance” &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tee&lt;/span&gt; /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;to-make-this-setting-persist-on-reboot&quot; tabindex=&quot;-1&quot;&gt;To make this setting persist on reboot: &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/pmx-power-consumption/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;You need to add a line to your crontab.  Open up the root user&#39;s crontab:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;crontab&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and add the following line at the bottom:&lt;/p&gt;
&lt;p&gt;@reboot echo &amp;quot;powersave&amp;quot; | tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor&lt;/p&gt;
&lt;p&gt;Save and reboot to test it.  Happy homelabbing!&lt;/p&gt;
&lt;p&gt;Happy homelabbing!&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>Proxmox TLS, SSH, Certificate Errors</title>
		<link href="https://stinky.blog/blog/pmx-certificate-error/"/>
		<updated>2023-01-01T00:00:00Z</updated>
		<id>https://stinky.blog/blog/pmx-certificate-error/</id>
		<content type="html">&lt;p&gt;Occasionally while adding/removing a node or making other significant changes to your Proxmox cluster, you&#39;ll get some errors about unauthorized SSH keys or Certificates.  You might be unable to migrate VMs/containers, unable to use virtual consoles, or unable to access the web interface at all.&lt;/p&gt;
&lt;p&gt;One example error:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;tls_process_server_certificate: certificate verify failed (596)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Generally, executing the following command will fix it right up:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;pvecm updatecerts &lt;span class=&quot;token parameter variable&quot;&gt;-F&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; systemctl restart pvedaemon pveproxy&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Sometimes, the nuclear option is required.  That means deleting all instances of the problem node from SSH known_hosts, verifying /etc/hosts info is correct on each node, and then executing the following:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;pvecm updatecerts &lt;span class=&quot;token parameter variable&quot;&gt;-F&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; pve-cluster stop &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; corosync stop &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; pvestatd stop &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; pveproxy stop &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; pvedaemon stop

&lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; pve-cluster start &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; corosync start &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; pvestatd start &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; pveproxy start&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I have had these errors occur after reinstalling Proxmox on a node and attempting to rejoin the cluster with the same hostname/ip.  Performing the steps above usually gets me back in business pretty quickly.&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>easyengine: simple wordpress + ssl deployment</title>
		<link href="https://stinky.blog/blog/easyengine/"/>
		<updated>2022-12-30T00:00:00Z</updated>
		<id>https://stinky.blog/blog/easyengine/</id>
		<content type="html">&lt;h2 id=&quot;baby-s-first-vps&quot; tabindex=&quot;-1&quot;&gt;Baby’s first VPS! &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/easyengine/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Now that the homelab cluster is running multiple external services, I’m starting to hit some speed bumps. Using my single domain name with tons of port numbers was working okay to keep services separated for personal use. But now with friends and family connecting and using some of these services, it’s time to switch to easy-to-remember subdomains. I will use a reverse proxy to intercept https requests and send them to the proper IPs and ports.&lt;/p&gt;
&lt;p&gt;That has been easier said than done, though! I have a lot more to learn about virtual hosts, ssl redirect loops, and how to format those dang config files!&lt;/p&gt;
&lt;p&gt;A VPS will allow me to keep some of my crap running externally while I figure all of that out.&lt;/p&gt;
&lt;h2 id=&quot;let-s-begin-buy-a-vps-and-start-it&quot; tabindex=&quot;-1&quot;&gt;Let’s begin – Buy a vps and start it &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/easyengine/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;I was able to find a 1 core, 1.5gb KVM VPS with 3TB monthly bandwidth and 30gb ssd for $16/year from &lt;a href=&quot;https://my.racknerd.com/aff.php?aff=6660&quot;&gt;RackNerd!&lt;/a&gt; Not a bad deal.
In the RackNerd control panel, I chose Ubuntu 22.04 as the OS for this vps.&lt;/p&gt;
&lt;p&gt;Once you start it up, they will email you some credentials to log in via ssh.&lt;/p&gt;
&lt;p&gt;After logging in, let’s install the latest security updates:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; update &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; upgrade &lt;span class=&quot;token parameter variable&quot;&gt;-y&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Use wget to download the easyengine installation script:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-qO&lt;/span&gt; ee https://rt.cx/ee4 &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bash&lt;/span&gt; ee&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;After the script finishes up, easyengine is ready to go.&lt;/p&gt;
&lt;h2 id=&quot;create-a-site&quot; tabindex=&quot;-1&quot;&gt;Create a site &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/easyengine/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;For most users, a single site with proxy caching on and SSL enabled through Let’s Encrypt is the best choice:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;ee site create stinky.blog –type&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;wp –ssl&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;le –proxy-cache&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;on –proxy-cache-max-size&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1g –proxy-cache-max-time&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;30s&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Replace stinky.blog with your domain.&lt;/p&gt;
&lt;p&gt;That’s it– it’s online! Access your site at http://&lt;em&gt;your_url&lt;/em&gt;.com/wp-admin/ and start creating pages.&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>Proxmox + Qbittorrent + Wireguard + Samba LXC</title>
		<link href="https://stinky.blog/blog/pmx-qbit-wg-lxc/"/>
		<updated>2022-12-01T00:00:00Z</updated>
		<id>https://stinky.blog/blog/pmx-qbit-wg-lxc/</id>
		<content type="html">&lt;p&gt;A google search for how to create this type of container will bring up a bunch of malarkey. It doesn’t have to be that complicated. You can set this up in a few minutes super easily. The result is an extremely lightweight and effective torrent box that you can control remotely. It works great on very modest hardware even with lots of traffic flowing.&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/0p3kt2JHsC-579.avif 579w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/0p3kt2JHsC-579.webp 579w&quot;&gt;&lt;img alt=&quot;container info&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/0p3kt2JHsC-579.jpeg&quot; width=&quot;579&quot; height=&quot;346&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;h2 id=&quot;first-spin-up-a-container&quot; tabindex=&quot;-1&quot;&gt;First, spin up a container. &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/pmx-qbit-wg-lxc/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/RQSkXuO37I-791.avif 791w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/RQSkXuO37I-791.webp 791w&quot;&gt;&lt;img alt=&quot;container creation&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/RQSkXuO37I-791.jpeg&quot; width=&quot;791&quot; height=&quot;387&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;Click on the local storage of one of your nodes, go to container templates, and click the Templates button. I am using the ubuntu 22.10-standard template, only 129mb.&lt;/p&gt;
&lt;p&gt;After downloading the template, right click your node and create the container. On the first page, make sure to uncheck ‘unprivileged container’ so that we will have full write access to the samba share. If you are storing files some other way, you can leave it unprivileged. (You can also achieve write access to cifs shares with an unprivileged container through user mapping if you so choose.)&lt;/p&gt;
&lt;p&gt;Select the ubuntu template on the next page. I went with the defaults for all the other options except 2 cpu cores and a static IP address.&lt;/p&gt;
&lt;h2 id=&quot;start-the-container&quot; tabindex=&quot;-1&quot;&gt;Start the container! &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/pmx-qbit-wg-lxc/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Now we can start the container and do some stuff.&lt;/p&gt;
&lt;p&gt;First, login with username root and the password you set during creation. Update everything with&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; update &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; upgrade &lt;span class=&quot;token parameter variable&quot;&gt;-y&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then, we need to install a few things&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; wireguard wireguard-tools &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; qbittorrent-nox cifs-utils iftop&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Since we installed cifs-utils in the last step, let’s go ahead and mount the network share. Edit your fstab file:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;nano&lt;/span&gt; /etc/fstab&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I have created a user on my NAS named qbit for this service and added it to the samba permissions. It only has access to a folder for downloads. My fstab looks kinda like this:&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/oxosvwo3TL-875.avif 875w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/oxosvwo3TL-875.webp 875w&quot;&gt;&lt;img alt=&quot;fstab config&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/oxosvwo3TL-875.jpeg&quot; width=&quot;875&quot; height=&quot;79&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ctrl + X&lt;/strong&gt; to save, then type &lt;strong&gt;reboot&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;The share should mount on reboot. If not, check for errors with &lt;strong&gt;journalctl -b&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;let-s-dig-a-wireguard-tunnel&quot; tabindex=&quot;-1&quot;&gt;Let’s dig a wireguard tunnel &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/pmx-qbit-wg-lxc/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Now you need to log into your VPN provider of choice and download your wireguard configuration. One easy way to do this would be to drop it on your NAS if you have connected one in the last step.&lt;/p&gt;
&lt;p&gt;Navigate to wherever you put that config file so we can move it to its final resting place. Below, mine is named wireguard-vpn.conf:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;mv&lt;/span&gt; wireguard-vpn.conf /etc/wireguard/wireguard-vpn.conf &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; /etc/wireguard &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Let’s see if that bad boy works:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;wg-quick up wireguard-vpn&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/qBkKeZntks-836.avif 836w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/qBkKeZntks-836.webp 836w&quot;&gt;&lt;img alt=&quot;wireguard output&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/qBkKeZntks-836.jpeg&quot; width=&quot;836&quot; height=&quot;333&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;If you connected successfully, typing &lt;strong&gt;ip addr show&lt;/strong&gt; will list a new tunnel interface at the bottom with your VPN IP!&lt;/p&gt;
&lt;p&gt;Now make it reconnect automatically on reboot:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;systemctl &lt;span class=&quot;token builtin class-name&quot;&gt;enable&lt;/span&gt; wg-quick@wireguard-vpn&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Reboot and hit it with another &lt;strong&gt;ip addr show&lt;/strong&gt; to make sure we’re still connected to the tunnel!&lt;/p&gt;
&lt;h2 id=&quot;enable-qbittorrent-nox&quot; tabindex=&quot;-1&quot;&gt;Enable qbittorrent-nox &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/pmx-qbit-wg-lxc/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;We’re on the home stretch! Now make a service that will start qbittorrent-nox automatically on boot:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;nano&lt;/span&gt; /etc/systemd/system/qbittorrent-nox.service&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We’ll keep it super simple:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Unit&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Description&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;qBittorrent-nox &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Documentation&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;man:qbittorrent-nox&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Wants&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;network-online.target
&lt;span class=&quot;token assign-left variable&quot;&gt;After&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;network-online.target nss-lookup.target

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Service&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;exec
&lt;span class=&quot;token assign-left variable&quot;&gt;ExecStart&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/usr/bin/qbittorrent-nox

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Install&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;WantedBy&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;multi-user.target&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now enable it and reboot to see if it works:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;systemctl &lt;span class=&quot;token builtin class-name&quot;&gt;enable&lt;/span&gt; qbittorrent-nox &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; systemctl daemon-reload &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;reboot&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Did it work?? You can try it by opening your web browser and typing in the local IP of the machine followed by port 8080!&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/WX1esYhBMp-759.avif 759w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/WX1esYhBMp-759.webp 759w&quot;&gt;&lt;img alt=&quot;working qbit interface&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/WX1esYhBMp-759.jpeg&quot; width=&quot;759&quot; height=&quot;577&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;h2 id=&quot;bind-qbt-nox-to-wireguard-interface&quot; tabindex=&quot;-1&quot;&gt;Bind Qbt-nox to wireguard interface &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/pmx-qbit-wg-lxc/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Last step! Go to &lt;strong&gt;Tools -&amp;gt; Options -&amp;gt; Advanced&lt;/strong&gt; and set the client to ONLY use the wireguard tunnel that we have created. If your VPN provides you a static IP, you can optionally set the client to ONLY use this IP as well.&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/Ytfrprzav2-837.avif 837w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/Ytfrprzav2-837.webp 837w&quot;&gt;&lt;img alt=&quot;bind to wireguard&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/Ytfrprzav2-837.jpeg&quot; width=&quot;837&quot; height=&quot;969&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;Now set your download folder to your samba share in the Downloads tab.&lt;/p&gt;
&lt;p&gt;That’s it! Now you can log in through this web interface from now on. You never have to access the container directly again. Add torrents by copying and pasting the magnet links into the webui from your phone or any other device!&lt;/p&gt;
&lt;p&gt;Ensure that traffic is flowing through the wireguard tunnel as expected by running the &lt;strong&gt;iftop&lt;/strong&gt; utility we downloaded earlier.&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>e-waste resurrection</title>
		<link href="https://stinky.blog/blog/e-waste/e-waste-resurrection/"/>
		<updated>2022-12-01T00:00:00Z</updated>
		<id>https://stinky.blog/blog/e-waste/e-waste-resurrection/</id>
		<content type="html">&lt;p&gt;Building a homelab on the cheap means using what you have laying around–even if what you have laying around is a dead Dell Inspiron 3521 from a decade ago. This laptop has already lived several lives. It got the wife through college. Before that, it traveled with the mother-in-law for business. It was pretty bad even back then, with a bendy plastic shell, mushy keyboard, and a screen like a gas pump. It does have an ivybridge i3, though! A 17-watt, 2 core, 4 thread behemoth locked at 1.9ghz with no turbo option. It has vt-d support and some usb ports, so it will be perfect as a node in my cluster for light containers and VMs like my NAS and Wireguard tunnels.&lt;/p&gt;
&lt;p&gt;The only problem: it doesn’t boot. It doesn’t even beep!&lt;/p&gt;
&lt;p&gt;Of course the cmos battery had died after all these years. Changing the battery got it to post! but only once. I accidentally knocked the cmos battery back out while it was running and corrupted the bios. It was SUPER dead this time, the cpu fan would only spin a partial turn before giving up.&lt;/p&gt;
&lt;p&gt;But never fear! Fixing a corrupted bios is pretty simple. The only two tools required are another working computer and a ch341a programmer (about $10 on Amazon) like this:&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/sXSKRFU8_o-400.avif 400w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/sXSKRFU8_o-400.webp 400w&quot;&gt;&lt;img alt=&quot;CH341a programmer&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/sXSKRFU8_o-400.jpeg&quot; width=&quot;400&quot; height=&quot;396&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;I found a dump of the original bios in a 2014 forum post on badcaps.net (thanks siddiq from ghana!).&lt;/p&gt;
&lt;p&gt;The ch341a comes with an 8-pin clip that connects directly to the pins on the bios chip. It is a little bit wobbly, and it will not read properly until it is making good contact with all 8 pins. You can make sure its working correctly by dumping the bios to a file, and then verifying the checksum against the file. The flashrom guide here was super easy to follow.&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/3jRVsZxj9J-400.avif 400w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/3jRVsZxj9J-400.webp 400w&quot;&gt;&lt;img alt=&quot;CH341a hooked up to bios chip and thinkpad&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/3jRVsZxj9J-400.jpeg&quot; width=&quot;400&quot; height=&quot;300&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;Flashrom autodetected the Winbond bios chip, I made a backup dump, and the checksum matched on the first try. I went ahead with flashrom -w on the dump I found online and… tadaaaa!&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/feu1EXEmv2-400.avif 400w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/feu1EXEmv2-400.webp 400w&quot;&gt;&lt;img alt=&quot;e-waste resurrected!  ready to begin a proxmox cluster.&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/feu1EXEmv2-400.jpeg&quot; width=&quot;400&quot; height=&quot;300&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;It works! Now it is a fully functioning node in my Proxmox cluster. On to rescuing more e-waste for the homelab.&lt;/p&gt;
</content>
	</entry>
</feed>
