<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:base="en">
	<title>stinky.blog</title>
	<subtitle>brain of brian. notes about fun things i&#39;m learning</subtitle>
	<link href="https://stinky.blog/feed/feed.xml" rel="self"/>
	<link href="https://stinky.blog/"/>
	<updated>2024-03-10T00:00:00Z</updated>
	<id>https://stinky.blog/</id>
	<author>
		<name>Brian</name>
		<email>brianm88@gmail.com</email>
	</author>
	
	<entry>
		<title>vim</title>
		<link href="https://stinky.blog/blog/rhcsa/vim/"/>
		<updated>2024-03-10T00:00:00Z</updated>
		<id>https://stinky.blog/blog/rhcsa/vim/</id>
		<content type="html">&lt;p&gt;&lt;strong&gt;vimtutor&lt;/strong&gt; to launch tutorial&lt;/p&gt;
&lt;h2 id=&quot;general&quot; tabindex=&quot;-1&quot;&gt;General &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/vim/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Starts in &lt;strong&gt;command mode&lt;/strong&gt;, press &lt;strong&gt;i&lt;/strong&gt; for &lt;strong&gt;insert mode&lt;/strong&gt; or &lt;strong&gt;a&lt;/strong&gt; for &lt;strong&gt;append mode&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Escape to re-enter command mode&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;:w&lt;/strong&gt; --  Save file&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;:q&lt;/strong&gt; -- Quit&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;:wq&lt;/strong&gt; -- Save and quit&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;:q!&lt;/strong&gt; --  Quit without saving&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;o&lt;/strong&gt; -- enters insert mode on a new line&lt;/p&gt;
&lt;h2 id=&quot;text-operations&quot; tabindex=&quot;-1&quot;&gt;Text Operations &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/vim/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;dd&lt;/strong&gt; -- delete current line&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;yy&lt;/strong&gt; -- copy current line&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;p&lt;/strong&gt; -- paste current line&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;u&lt;/strong&gt; -- undo&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ctrl+r&lt;/strong&gt; -- redo&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;:%s/oldword/newword/g&lt;/strong&gt; -- substitute phrase -- /g = all instances&lt;/p&gt;
&lt;h2 id=&quot;visual-mode&quot; tabindex=&quot;-1&quot;&gt;Visual mode &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/vim/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;v&lt;/strong&gt; --  enter visual mode&lt;/p&gt;
&lt;p&gt;highlight text starting from current cursor position then copy/paste/delete/etc&lt;/p&gt;
&lt;h2 id=&quot;navigate&quot; tabindex=&quot;-1&quot;&gt;Navigate &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/vim/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;gg&lt;/strong&gt; -- top of document&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;G&lt;/strong&gt; -- end of document&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;/word&lt;/strong&gt; -- search for &amp;quot;word&amp;quot;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;?word&lt;/strong&gt; -- search backwards for &amp;quot;word&amp;quot;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;^&lt;/strong&gt; -- move to beginning of line&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;$&lt;/strong&gt; -- move to end of line&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;w&lt;/strong&gt; -- move to next word&lt;/p&gt;
&lt;h2 id=&quot;display&quot; tabindex=&quot;-1&quot;&gt;Display &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/vim/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;:se numbers&lt;/strong&gt; -- show line numbers&lt;/p&gt;
&lt;hr&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;em&gt;this page written proudly in nano&lt;/em&gt;&lt;/p&gt;
&lt;/blockquote&gt;
</content>
	</entry>
	
	<entry>
		<title>stdin, stdout, stderr</title>
		<link href="https://stinky.blog/blog/rhcsa/stds/"/>
		<updated>2024-03-10T00:00:00Z</updated>
		<id>https://stinky.blog/blog/rhcsa/stds/</id>
		<content type="html">&lt;h2 id=&quot;redirection&quot; tabindex=&quot;-1&quot;&gt;Redirection &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/stds/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Write (or overwrite) stdout to file:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;thing &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; place&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Append stdout to file:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;thing &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; place&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Write/append errors to a file:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;thing &lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;2&lt;/span&gt;&gt;&lt;/span&gt; or &lt;span class=&quot;token operator&quot;&gt;&lt;span class=&quot;token file-descriptor important&quot;&gt;2&lt;/span&gt;&gt;&gt;&lt;/span&gt; place&lt;/code&gt;&lt;/pre&gt;
</content>
	</entry>
	
	<entry>
		<title>man</title>
		<link href="https://stinky.blog/blog/rhcsa/man/"/>
		<updated>2024-03-10T00:00:00Z</updated>
		<id>https://stinky.blog/blog/rhcsa/man/</id>
		<content type="html">&lt;h2 id=&quot;sections&quot; tabindex=&quot;-1&quot;&gt;Sections &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/man/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;executables / shell cmds&lt;/li&gt;
&lt;li&gt;system calls&lt;/li&gt;
&lt;li&gt;library calls&lt;/li&gt;
&lt;li&gt;special files (/dev)&lt;/li&gt;
&lt;li&gt;file formats / conventions&lt;/li&gt;
&lt;li&gt;games&lt;/li&gt;
&lt;li&gt;misc&lt;/li&gt;
&lt;li&gt;sys admin / root&lt;/li&gt;
&lt;li&gt;kernel routines&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;To search for a command in a particular section, &lt;strong&gt;man # command&lt;/strong&gt;&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;man&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;passwd&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;man returns the first section number for a given command.  to see all sections:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;man&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-a&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;passwd&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;navigation&quot; tabindex=&quot;-1&quot;&gt;Navigation &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/man/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Use / to search&lt;/p&gt;
&lt;p&gt;spacebar / pgdown / pgup to scroll&lt;/p&gt;
&lt;h2 id=&quot;searching&quot; tabindex=&quot;-1&quot;&gt;Searching &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/man/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Search the NAME field:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;man&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-k&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;keyword&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;or&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apropos&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;keyword&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;n for next result, p for previous&lt;/p&gt;
&lt;h2 id=&quot;mandb&quot; tabindex=&quot;-1&quot;&gt;mandb &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/man/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Search index needs to be built  with &lt;strong&gt;mandb&lt;/strong&gt; command (cronjob or manually)&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; mandb&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;search returns &amp;quot;nothing appropriate&amp;quot; ? run &lt;strong&gt;mandb&lt;/strong&gt;&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>bash shortcuts</title>
		<link href="https://stinky.blog/blog/rhcsa/bash-shortcuts/"/>
		<updated>2024-03-10T00:00:00Z</updated>
		<id>https://stinky.blog/blog/rhcsa/bash-shortcuts/</id>
		<content type="html">&lt;h2 id=&quot;ctrl&quot; tabindex=&quot;-1&quot;&gt;Ctrl &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/bash-shortcuts/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Shortcut&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ctrl + D&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;End of file&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ctrl + C&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Interrupt a command&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ctrl + Z&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Suspend a command&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ctrl + A&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Move to start of line&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ctrl + E&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Move to end of line&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ctrl + K&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Cut text to end of line&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ctrl + U&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Cut text to start of line&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ctrl + Y&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Paste the last cut text&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ctrl + R&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Search history backwards&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Ctrl + L&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Clear the screen&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&quot;alt&quot; tabindex=&quot;-1&quot;&gt;Alt &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/bash-shortcuts/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Shortcut&lt;/th&gt;
&lt;th&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + b&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Move back one word&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + f&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Move forward one word&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + d&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Delete word right of the cursor&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + Backspace&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Delete word left of the cursor&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + &amp;lt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Move to the beginning of the history&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + &amp;gt;&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Move to the end of the history&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + t&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Swap the current word with the previous&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + u&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Uppercase word from cursor to end of word&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + l&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Lowercase word from cursor to end of word&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + c&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Capitalize the word&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;Alt + r&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;Revert any changes to a command you&#39;ve pulled from history&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
</content>
	</entry>
	
	<entry>
		<title>bash history</title>
		<link href="https://stinky.blog/blog/rhcsa/bash-history/"/>
		<updated>2024-03-10T00:00:00Z</updated>
		<id>https://stinky.blog/blog/rhcsa/bash-history/</id>
		<content type="html">&lt;h2 id=&quot;history&quot; tabindex=&quot;-1&quot;&gt;History &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/bash-history/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;bash keeps all recently used commands in ~./bash_history&lt;/p&gt;
&lt;p&gt;To see all recently used bash commands:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;history&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Ctrl + r&lt;/strong&gt; To search history&lt;/p&gt;
&lt;p&gt;To repeat a command by its line # on &#39;history&#39;:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;nn&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Repeat last command that starts with letter a:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;a&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Repeat last command with sudo:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;history-settings&quot; tabindex=&quot;-1&quot;&gt;History settings &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/rhcsa/bash-history/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Set two environment variables $HISTSIZE and $HISTFILESIZE&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;500&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$HISTSIZE&lt;/span&gt; or &lt;span class=&quot;token environment constant&quot;&gt;$HISTFILESIZE&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;to make permanent, add to ~/.bashrc&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;&lt;span class=&quot;token environment constant&quot;&gt;HISTFILESIZE&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;500&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;&lt;span class=&quot;token environment constant&quot;&gt;HISTSIZE&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;500&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Write current history to history file:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;history&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-w&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Clear current history:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;history&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-c&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Clear specific line:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;history&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-d&lt;/span&gt; nn&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;History file is not merged until terminal exit&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>ZFS Volblocksize for VM Workloads</title>
		<link href="https://stinky.blog/blog/zfs-bench/"/>
		<updated>2024-03-06T00:00:00Z</updated>
		<id>https://stinky.blog/blog/zfs-bench/</id>
		<content type="html">&lt;p&gt;I store all of my VMs on ZFS pools.  On Proxmox, VMs stored on ZFS pools will use zvols by default, rather than a disk file in a dataset. Proxmox zvols use a default volblocksize of 8k.  What the heck is a zvol, and what is the impact on storage performance?&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Zvols&lt;/strong&gt; present a virtual block device to the VM, like a physical disk.  It sounds pretty cool, but it comes with some caveats.  Zvols use a &lt;em&gt;volblocksize&lt;/em&gt; rather than a recordsize or a block size.  Selecting the wrong volblocksize for your workload can result in extreme write amplification, increased drive wear, and terrible performance.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Volblocksize&lt;/strong&gt; represents the &lt;em&gt;minimum&lt;/em&gt; amount of data that can be written to a zvol.  This is the opposite of recordsize, which refers to the maximum.  Writing a 1kb file to a zpool with a recordsize of 128k is no problem -- ZFS will simply write 1k. The same 1k write on a zvol with volblocksize of 128k will cause 128k of data to be written.  That&#39;s a write amplification of &lt;strong&gt;128x&lt;/strong&gt;.  No bueno!&lt;/p&gt;
&lt;p&gt;A similar situation occurs in reverse.  You have a 128k volblocksize and you need to read 1k.  ZFS must read the whole 128k block to return your 1k data.  This can greatly increase latency and reduce IOPs.&lt;/p&gt;
&lt;p&gt;It gets even worse if you&#39;re calculating parity -- arrays with certain drive configurations can lose 50% or more of their total usable space to metadata when block size is set too low.  Look for posts discussing &amp;quot;padding overhead&amp;quot; or &lt;a href=&quot;https://www.delphix.com/blog/zfs-raidz-stripe-width-or-how-i-learned-stop-worrying-and-love-raidz&quot;&gt;posts like this&lt;/a&gt; for more info.&lt;/p&gt;
&lt;p&gt;I was hoping that the perfect volblocksize would be just a google search away... but it looks like it&#39;s gonna be more complicated than that!  The volblocksize should precisely match the workload, 16k for databases which perform 16k writes, for example.  I&#39;m not sure exactly what that would be for my typical usage.  So, my goal here is to just to learn what I can about how ZFS interacts with zvols, starting with some simple tests.&lt;/p&gt;
&lt;h2 id=&quot;testing-methodology-round-1&quot; tabindex=&quot;-1&quot;&gt;Testing Methodology - Round 1 &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-bench/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;I&#39;ll be using a striped mirror containing 4x 12TB drives.  The underlying pool has ashift=12, compression=LZ4, recordsize=128k.  I am testing inside a Debian VM with ext4 filesystem, 4k blocks, cache=none.&lt;/p&gt;
&lt;p&gt;To test each volblocksize, I am simply moving the virtual disk off of the pool, resetting the volblocksize, and then moving the virtual disk back to the pool.  (The data needs to be written again in order for the new volblocksize to take effect.)&lt;/p&gt;
&lt;p&gt;For round one, I would like to find the extremes -- just to get some idea of the relationship between these values.&lt;/p&gt;
&lt;p&gt;First, I used fio to test random writes of 4k and 1M blocks at queue depth 1.  I ran both tests on volblocksizes 8k, 16k, 32k, and 64k. sync=disabled&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;fio &lt;span class=&quot;token parameter variable&quot;&gt;--name&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;random-write &lt;span class=&quot;token parameter variable&quot;&gt;--ioengine&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;posixaio &lt;span class=&quot;token parameter variable&quot;&gt;--rw&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;randwrite &lt;span class=&quot;token parameter variable&quot;&gt;--bs&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1M &lt;span class=&quot;token parameter variable&quot;&gt;--size&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;4g &lt;span class=&quot;token parameter variable&quot;&gt;--numjobs&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--iodepth&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--runtime&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;60&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--time_based&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--end_fsync&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
random-write: &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;g&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;: &lt;span class=&quot;token assign-left variable&quot;&gt;rw&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;randwrite, &lt;span class=&quot;token assign-left variable&quot;&gt;bs&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;R&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; 1024KiB-1024KiB, &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;W&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; 1024KiB-1024KiB, &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;T&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; 1024KiB-1024KiB, &lt;span class=&quot;token assign-left variable&quot;&gt;ioengine&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;posixaio, &lt;span class=&quot;token assign-left variable&quot;&gt;iodepth&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;br&gt;
&lt;h2 id=&quot;4k-random-writes&quot; tabindex=&quot;-1&quot;&gt;4k random writes: &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-bench/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Volblocksize&lt;/th&gt;
&lt;th&gt;Block Size&lt;/th&gt;
&lt;th&gt;IOPS&lt;/th&gt;
&lt;th&gt;Bandwidth (MiB/s)&lt;/th&gt;
&lt;th&gt;Average Latency (μs)&lt;/th&gt;
&lt;th&gt;99th Percentile Latency (μs)&lt;/th&gt;
&lt;th&gt;Disk Utilization (%)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;8K&lt;/td&gt;
&lt;td&gt;4K&lt;/td&gt;
&lt;td&gt;15.7k&lt;/td&gt;
&lt;td&gt;61.2&lt;/td&gt;
&lt;td&gt;41.74&lt;/td&gt;
&lt;td&gt;99&lt;/td&gt;
&lt;td&gt;86.15&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;16K&lt;/td&gt;
&lt;td&gt;4K&lt;/td&gt;
&lt;td&gt;18.1k&lt;/td&gt;
&lt;td&gt;70.8&lt;/td&gt;
&lt;td&gt;32.89&lt;/td&gt;
&lt;td&gt;93&lt;/td&gt;
&lt;td&gt;78.41&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;32K&lt;/td&gt;
&lt;td&gt;4K&lt;/td&gt;
&lt;td&gt;19.7k&lt;/td&gt;
&lt;td&gt;76.8&lt;/td&gt;
&lt;td&gt;33.55&lt;/td&gt;
&lt;td&gt;105&lt;/td&gt;
&lt;td&gt;79.44&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;64K&lt;/td&gt;
&lt;td&gt;4K&lt;/td&gt;
&lt;td&gt;25.1k&lt;/td&gt;
&lt;td&gt;97.9&lt;/td&gt;
&lt;td&gt;35.81&lt;/td&gt;
&lt;td&gt;126&lt;/td&gt;
&lt;td&gt;55.38&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;These results were surprising to me!  Switching from 8k to 64k volblocksize, we see a 60% increase in throughput and a huge drop in iowait.  There is a 60% increase in IOPs, as well.&lt;/p&gt;
&lt;p&gt;I will have to run some more detailed tests here, but I suspect these huge gains may come with huge penalties in other areas.  Namely, random reads that miss the ARC, or writes that require read/modify/write.  Will have to figure out how to test that later.&lt;/p&gt;
&lt;br&gt;  
&lt;h2 id=&quot;1m-random-writes&quot; tabindex=&quot;-1&quot;&gt;1M random writes: &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/zfs-bench/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Volblocksize&lt;/th&gt;
&lt;th&gt;Block Size&lt;/th&gt;
&lt;th&gt;IOPS&lt;/th&gt;
&lt;th&gt;Bandwidth (MiB/s)&lt;/th&gt;
&lt;th&gt;Average Latency (μs)&lt;/th&gt;
&lt;th&gt;99th Percentile Latency (μs)&lt;/th&gt;
&lt;th&gt;Disk Utilization (%)&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;8K&lt;/td&gt;
&lt;td&gt;1M&lt;/td&gt;
&lt;td&gt;163&lt;/td&gt;
&lt;td&gt;164&lt;/td&gt;
&lt;td&gt;3136.59&lt;/td&gt;
&lt;td&gt;217056&lt;/td&gt;
&lt;td&gt;93.79&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;16K&lt;/td&gt;
&lt;td&gt;1M&lt;/td&gt;
&lt;td&gt;177&lt;/td&gt;
&lt;td&gt;178&lt;/td&gt;
&lt;td&gt;3638.31&lt;/td&gt;
&lt;td&gt;125305&lt;/td&gt;
&lt;td&gt;90.54&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;32K&lt;/td&gt;
&lt;td&gt;1M&lt;/td&gt;
&lt;td&gt;311&lt;/td&gt;
&lt;td&gt;312&lt;/td&gt;
&lt;td&gt;2207.24&lt;/td&gt;
&lt;td&gt;143655&lt;/td&gt;
&lt;td&gt;89.67&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;64K&lt;/td&gt;
&lt;td&gt;1M&lt;/td&gt;
&lt;td&gt;338&lt;/td&gt;
&lt;td&gt;339&lt;/td&gt;
&lt;td&gt;1933.32&lt;/td&gt;
&lt;td&gt;43779&lt;/td&gt;
&lt;td&gt;93.11&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;Same story here!  106% increase in random write speed switching from 8k volblocksize to 64k.   107% increase in IOPs.  Much larger reduction in disk latency here than in the 4k tests.&lt;/p&gt;
&lt;p&gt;I would bet we get the same trade-off here, issues with small random reads and modifying files in place.  Someone give me a trail of breadcrumbs for how to test that!&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/2gS10ltJ7R-594.avif 594w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/2gS10ltJ7R-594.webp 594w&quot;&gt;&lt;img alt=&quot;line graph&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/2gS10ltJ7R-594.jpeg&quot; width=&quot;594&quot; height=&quot;319&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;Looking forward to round 2.  Next time, I&#39;d like to find a way to see how much amplification is going on here, as well as how badly this is affecting reads outside of ARC.&lt;/p&gt;
&lt;p&gt;Would love some feedback on my methodology and some pointers!  More fun to learn with friends.  brianm88 @ gmail.com or /dev/goat on Steam.&lt;/p&gt;
&lt;p&gt;Thanks for reading.  Happy homelabbing!&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>Building a better backup server</title>
		<link href="https://stinky.blog/blog/backup-server/backup-server-build/"/>
		<updated>2024-03-05T00:00:00Z</updated>
		<id>https://stinky.blog/blog/backup-server/backup-server-build/</id>
		<content type="html">&lt;p&gt;It&#39;s always exciting to get new homelab stuff!  Here&#39;s what I&#39;ve been up to.&lt;/p&gt;
&lt;p&gt;My old Proxmox Backup Server has been running on a Thinkpad x270 with a 5TB external USB drive for a little over a year now.  It is installed alongside the hypervisor, with ZFS on the datastore.  It&#39;s been working great!  Backup times were not &lt;em&gt;that&lt;/em&gt; bad, but restore times were really slow.&lt;/p&gt;
&lt;p&gt;I still use that node as a secondary backup server, which will clone the primary backup datastore daily.  I plan to move it to my mom&#39;s house and leave it connected via tailscale as part of my little &amp;quot;3-2-1&amp;quot; backup plan.&lt;/p&gt;
&lt;p&gt;I wanted to build a better, faster PBS server that can also double as a robust Proxmox node for other tasks.  I also wanted to do it cheap!  So I started hunting on ebay...&lt;/p&gt;
&lt;h2 id=&quot;the-new-server&quot; tabindex=&quot;-1&quot;&gt;The new server &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/backup-server/backup-server-build/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;You already know I bought another Thinkstation.&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/zzH1bw69e7-400.avif 400w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/zzH1bw69e7-400.webp 400w&quot;&gt;&lt;img alt=&quot;Thinkstation P320&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/zzH1bw69e7-400.jpeg&quot; width=&quot;400&quot; height=&quot;533&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;I bought a P320 Tower, little brother to the P330 SFF I already have. It came with an i7-7700k, 512gb nvme, and 32gb of ddr4.&lt;/p&gt;
&lt;p&gt;Here are the parts I was able to get and the prices:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Quantity&lt;/th&gt;
&lt;th&gt;Item&lt;/th&gt;
&lt;th&gt;Price&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;Thinkstation P320&lt;/td&gt;
&lt;td&gt;$163&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;12TB Toshiba MG07ACA12TEY (new)&lt;/td&gt;
&lt;td&gt;$100/each&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;12TB WD HUH721212AL (used)&lt;/td&gt;
&lt;td&gt;$90/each&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;32GB Timetec ddr4 2600&lt;/td&gt;
&lt;td&gt;$50&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1&lt;/td&gt;
&lt;td&gt;10gbe Intel X520 nic&lt;/td&gt;
&lt;td&gt;$20&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;2&lt;/td&gt;
&lt;td&gt;Orico hot swap bay adapter 5.25&amp;quot;&lt;/td&gt;
&lt;td&gt;$18&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;---&lt;/td&gt;
&lt;td&gt;---&lt;/td&gt;
&lt;td&gt;---&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Total&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;$649&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;So for less than the cost of a decent NAS with no disks, I was able to get 48TBs, 10gbe, 64gb ram and a fairly strong kaby lake cpu.  One day when we reach a post-scarcity society, I&#39;ll swap to ECC memory and get more flash storage.&lt;/p&gt;
&lt;h2 id=&quot;hardware&quot; tabindex=&quot;-1&quot;&gt;Hardware &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/backup-server/backup-server-build/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Both the &amp;quot;new&amp;quot; drives and the &amp;quot;used&amp;quot; drives came in Dell hotswap bays, which I had to remove.&lt;br&gt;
&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/u6qDAQKe0l-400.avif 400w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/u6qDAQKe0l-400.webp 400w&quot;&gt;&lt;img alt=&quot;Dell drive caddy&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/u6qDAQKe0l-400.jpeg&quot; width=&quot;400&quot; height=&quot;533&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;This case only has 2 slots for 3.5&amp;quot; drives, so I slipped the little plastic Lenovo caddy on two of them.&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/DOZ-EKQ58A-400.avif 400w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/DOZ-EKQ58A-400.webp 400w&quot;&gt;&lt;img alt=&quot;Lenovo drive caddy&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/DOZ-EKQ58A-400.jpeg&quot; width=&quot;400&quot; height=&quot;300&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;For the other two drives, I used the two hotswap bays from Amazon.  Very cool little devices for $18!&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/6h_VGyvyih-400.avif 400w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/6h_VGyvyih-400.webp 400w&quot;&gt;&lt;img alt=&quot;Hot swap bay&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/6h_VGyvyih-400.jpeg&quot; width=&quot;400&quot; height=&quot;300&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;Pretty tidy!  There is a garbage SSD free-floating around in there.  We&#39;ll chat more about that in the ZFS optimization post. (Foreshadowing:  awful SSDs make awful SLOG/L2Arc devices)&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/6T6z6DWQvc-400.avif 400w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/6T6z6DWQvc-400.webp 400w&quot;&gt;&lt;img alt=&quot;Server internals with drives hooked up&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/6T6z6DWQvc-400.jpeg&quot; width=&quot;400&quot; height=&quot;300&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;It looks pretty awesome with the drive bays now!  The lights are REALLY bright though, if that&#39;s not your thing.  Blue when powered on, red for activity.  It&#39;s like a police raid when the backups are running.&lt;/p&gt;
&lt;p&gt;Excuse the wires, had to plug in a monitor to troubleshoot (network cable was plugged into wrong port):&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/8xnhi5QQGN-400.avif 400w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/8xnhi5QQGN-400.webp 400w&quot;&gt;&lt;img alt=&quot;Server rack with backup server installed&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/8xnhi5QQGN-400.jpeg&quot; width=&quot;400&quot; height=&quot;533&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;h2 id=&quot;initial-config&quot; tabindex=&quot;-1&quot;&gt;Initial config &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/backup-server/backup-server-build/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Pretty simple, just slapped Proxmox on it, installed Proxmox Backup Server alongside it.&lt;/p&gt;
&lt;p&gt;The ZFS pool is setup as a striped mirror, with two drives in each vdev. Ashift=12, compression=LZ4, recordsize=1M.&lt;/p&gt;
&lt;h2 id=&quot;first-impressions&quot; tabindex=&quot;-1&quot;&gt;First impressions &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/backup-server/backup-server-build/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/mtuSOuIa1e-400.avif 400w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/mtuSOuIa1e-400.webp 400w&quot;&gt;&lt;img alt=&quot;Backup speed&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/mtuSOuIa1e-400.jpeg&quot; width=&quot;400&quot; height=&quot;290&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;Backups and restores are roughly ~10x faster!  Old backup server would write at about ~20MB/s.  Now backups are writing at 250MB/s+.  Reads are obviously much higher (~20 seconds to restore average 32GB linux VMs).  Live restores work great.  This node also has 8 times as much memory as the old x270 has, so I&#39;m able to run a lot more VMs on it as well.  Pretty good deal!&lt;/p&gt;
&lt;p&gt;Very excited to delve deeper into ZFS and start testing my workload and optimizing the pool settings.&lt;/p&gt;
&lt;p&gt;I have been messing with recordsizes, volblocksizes, SLOG devices, and L2arc already!  The next post will contain some of my findings.&lt;/p&gt;
&lt;p&gt;Happy homelabbing!&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>Adios Wordpress?</title>
		<link href="https://stinky.blog/blog/adios-wordpress/"/>
		<updated>2024-03-03T00:00:00Z</updated>
		<id>https://stinky.blog/blog/adios-wordpress/</id>
		<content type="html">&lt;p&gt;Welcome to my first post on a static site.  Wordpress has been super cool, but I really wanted to try out something simpler and easier to deploy from the commandline.&lt;/p&gt;
&lt;p&gt;It has been a blast hosting the blog on the VPS and learning the ins-and-outs of securing the server, managing the certificates, and general wordpress admin stuff.  Wordpress plugins have been very awesome and easy to use, even the free ones.  However, it&#39;s just a ton of functionality that I don&#39;t really need.&lt;/p&gt;
&lt;p&gt;I watched a couple of youtube videos about hosting static sites on github pages with jekyll and other static site generators.  That led me to trying out a few of them before landing on this one, eleventy.&lt;/p&gt;
&lt;p&gt;To get this running, I created a github repository: username.github.io&lt;/p&gt;
&lt;p&gt;Then, I cloned the repo to my home folder&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone https://github.com/brianm88/brianm88.github.io&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I used this eleventy template: &lt;a href=&quot;https://github.com/11ty/eleventy-base-blog&quot;&gt;eleventy-base-blog&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Cloned those files to my github folder and ran eleventy:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;npx @11ty/eleventy &lt;span class=&quot;token parameter variable&quot;&gt;--serve&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;There I had a working skeleton!  But, I wanted a search bar.  So I found a solution with pagefind: &lt;a href=&quot;https://pagefind.app/&quot;&gt;pagefind&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Pretty much just need to insert this line into one of the pages to get it working.  In my case, inserted it in to /my-repo/_includes/layouts/home.njk&lt;/p&gt;
&lt;pre class=&quot;language-http&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-http&quot;&gt;&amp;lt;link href=&quot;/pagefind/pagefind-ui.css&quot; rel=&quot;stylesheet&quot;&gt;
&amp;lt;script src=&quot;/pagefind/pagefind-ui.js&quot;&gt;&amp;lt;/script&gt;
&amp;lt;div id=&quot;search&quot;&gt;&amp;lt;/div&gt;
&amp;lt;script&gt;
    window.addEventListener(&#39;DOMContentLoaded&#39;, (event) =&gt; {
        new PagefindUI({ element: &quot;#search&quot;, showSubResults: true });
    });
&amp;lt;/script&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then, you need to run the indexer to let it build an index of your site files.&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;npx &lt;span class=&quot;token parameter variable&quot;&gt;-y&lt;/span&gt; pagefind &lt;span class=&quot;token parameter variable&quot;&gt;--site&lt;/span&gt; _site&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then I had some weird issues getting github pages to let me select the right folder.  So, I created a /docs/ folder like they suggest, and I just rsynced the stuff into it.  I wrote this into a script so I can execute all this in one command.  The script also takes a commit comment and pushes to github:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash&lt;/span&gt;

&lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 11ty build&lt;/span&gt;
npx @11ty/eleventy

&lt;span class=&quot;token comment&quot;&gt;# pagefind build index&lt;/span&gt;
npx &lt;span class=&quot;token parameter variable&quot;&gt;-y&lt;/span&gt; pagefind &lt;span class=&quot;token parameter variable&quot;&gt;--site&lt;/span&gt; _site/

&lt;span class=&quot;token comment&quot;&gt;# rsync to gitpages folder&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;rsync&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-arui&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--delete&lt;/span&gt; _site/ docs

&lt;span class=&quot;token comment&quot;&gt;# Prompt for commit message&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Enter commit message:&quot;&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;read&lt;/span&gt; commit_message

&lt;span class=&quot;token comment&quot;&gt;# git operations&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; docs
&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; commit &lt;span class=&quot;token parameter variable&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$commit_message&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; push &lt;span class=&quot;token parameter variable&quot;&gt;-u&lt;/span&gt; origin main&lt;/code&gt;&lt;/pre&gt;
</content>
	</entry>
	
	<entry>
		<title>Reducing power consumption of Proxmox nodes</title>
		<link href="https://stinky.blog/blog/pmx-power-consumption/"/>
		<updated>2023-09-07T00:00:00Z</updated>
		<id>https://stinky.blog/blog/pmx-power-consumption/</id>
		<content type="html">&lt;p&gt;I noticed the other day that my proxmox nodes are running at max turbo frequency all the time. Even when there is virtually zero activity, the 8700 and 7700k are sitting at 4.2ghz+ on all cores. The little x270 stays locked at 3.4ghz on its two cores. Since these servers idle a huge amount, they really don’t need to be at max turbo constantly. I saw it recommended on the Proxmox forum to change the cpu governor. Does it work?&lt;/p&gt;
&lt;h2 id=&quot;let-s-measure-the-power-consumption&quot; tabindex=&quot;-1&quot;&gt;Let&#39;s measure the power consumption. &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/pmx-power-consumption/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;First, we need to install linux-cpupower&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; linux-cpupower&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then we can run turbostat to get a rough idea:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;turbostat –quiet –show Package,Busy%,Bzy_MHz,PkgTmp,PkgWatt,CoreTmp –interval &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;With the default governor, my i7-8700 was idling at around ~8.2 watts according to &amp;quot;PkgWatt&amp;quot;.&lt;/p&gt;
&lt;h2 id=&quot;let-s-change-the-cpu-governor&quot; tabindex=&quot;-1&quot;&gt;Let&#39;s change the cpu governor &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/pmx-power-consumption/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Changing the governor is pretty easy:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; “powersave” &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tee&lt;/span&gt; /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now run the turbostat command again to see how the cpu frequency and power consumption have changed.&lt;/p&gt;
&lt;p&gt;My i7-8700 is now idling around ~2.9 watts according to &amp;quot;PkgWatt&amp;quot;.&lt;/p&gt;
&lt;p&gt;Pretty nice reductions! Haven’t noticed any changes in performance for my normal services, since the turbo just ramps back up as expected when you apply a load.&lt;/p&gt;
&lt;p&gt;You can revert the change back to default easily:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; “performance” &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tee&lt;/span&gt; /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&quot;to-make-this-setting-persist-on-reboot&quot; tabindex=&quot;-1&quot;&gt;To make this setting persist on reboot: &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/pmx-power-consumption/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;You need to add a line to your crontab.  Open up the root user&#39;s crontab:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;crontab&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;and add the following line at the bottom:&lt;/p&gt;
&lt;p&gt;@reboot echo &amp;quot;powersave&amp;quot; | tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor&lt;/p&gt;
&lt;p&gt;Save and reboot to test it.  Happy homelabbing!&lt;/p&gt;
&lt;p&gt;Happy homelabbing!&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>Proxmox TLS, SSH, Certificate Errors</title>
		<link href="https://stinky.blog/blog/pmx-certificate-error/"/>
		<updated>2023-01-01T00:00:00Z</updated>
		<id>https://stinky.blog/blog/pmx-certificate-error/</id>
		<content type="html">&lt;p&gt;Occasionally while adding/removing a node or making other significant changes to your Proxmox cluster, you&#39;ll get some errors about unauthorized SSH keys or Certificates.  You might be unable to migrate VMs/containers, unable to use virtual consoles, or unable to access the web interface at all.&lt;/p&gt;
&lt;p&gt;One example error:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;tls_process_server_certificate: certificate verify failed (596)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Generally, executing the following command will fix it right up:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;pvecm updatecerts &lt;span class=&quot;token parameter variable&quot;&gt;-F&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; systemctl restart pvedaemon pveproxy&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Sometimes, the nuclear option is required.  That means deleting all instances of the problem node from SSH known_hosts, verifying /etc/hosts info is correct on each node, and then executing the following:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;pvecm updatecerts &lt;span class=&quot;token parameter variable&quot;&gt;-F&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; pve-cluster stop &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; corosync stop &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; pvestatd stop &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; pveproxy stop &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; pvedaemon stop

&lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; pve-cluster start &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; corosync start &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; pvestatd start &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; pveproxy start&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I have had these errors occur after reinstalling Proxmox on a node and attempting to rejoin the cluster with the same hostname/ip.  Performing the steps above usually gets me back in business pretty quickly.&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>easyengine: simple wordpress + ssl deployment</title>
		<link href="https://stinky.blog/blog/easyengine/"/>
		<updated>2022-12-30T00:00:00Z</updated>
		<id>https://stinky.blog/blog/easyengine/</id>
		<content type="html">&lt;h2 id=&quot;baby-s-first-vps&quot; tabindex=&quot;-1&quot;&gt;Baby’s first VPS! &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/easyengine/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Now that the homelab cluster is running multiple external services, I’m starting to hit some speed bumps. Using my single domain name with tons of port numbers was working okay to keep services separated for personal use. But now with friends and family connecting and using some of these services, it’s time to switch to easy-to-remember subdomains. I will use a reverse proxy to intercept https requests and send them to the proper IPs and ports.&lt;/p&gt;
&lt;p&gt;That has been easier said than done, though! I have a lot more to learn about virtual hosts, ssl redirect loops, and how to format those dang config files!&lt;/p&gt;
&lt;p&gt;A VPS will allow me to keep some of my crap running externally while I figure all of that out.&lt;/p&gt;
&lt;h2 id=&quot;let-s-begin-buy-a-vps-and-start-it&quot; tabindex=&quot;-1&quot;&gt;Let’s begin – Buy a vps and start it &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/easyengine/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;I was able to find a 1 core, 1.5gb KVM VPS with 3TB monthly bandwidth and 30gb ssd for $16/year from &lt;a href=&quot;https://my.racknerd.com/aff.php?aff=6660&quot;&gt;RackNerd!&lt;/a&gt; Not a bad deal.
In the RackNerd control panel, I chose Ubuntu 22.04 as the OS for this vps.&lt;/p&gt;
&lt;p&gt;Once you start it up, they will email you some credentials to log in via ssh.&lt;/p&gt;
&lt;p&gt;After logging in, let’s install the latest security updates:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; update &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; upgrade &lt;span class=&quot;token parameter variable&quot;&gt;-y&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Use wget to download the easyengine installation script:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-qO&lt;/span&gt; ee https://rt.cx/ee4 &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bash&lt;/span&gt; ee&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;After the script finishes up, easyengine is ready to go.&lt;/p&gt;
&lt;h2 id=&quot;create-a-site&quot; tabindex=&quot;-1&quot;&gt;Create a site &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/easyengine/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;For most users, a single site with proxy caching on and SSL enabled through Let’s Encrypt is the best choice:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;ee site create stinky.blog –type&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;wp –ssl&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;le –proxy-cache&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;on –proxy-cache-max-size&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1g –proxy-cache-max-time&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;30s&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Replace stinky.blog with your domain.&lt;/p&gt;
&lt;p&gt;That’s it– it’s online! Access your site at http://&lt;em&gt;your_url&lt;/em&gt;.com/wp-admin/ and start creating pages.&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>Proxmox + Qbittorrent + Wireguard + Samba LXC</title>
		<link href="https://stinky.blog/blog/pmx-qbit-wg-lxc/"/>
		<updated>2022-12-01T00:00:00Z</updated>
		<id>https://stinky.blog/blog/pmx-qbit-wg-lxc/</id>
		<content type="html">&lt;p&gt;A google search for how to create this type of container will bring up a bunch of malarkey. It doesn’t have to be that complicated. You can set this up in a few minutes super easily. The result is an extremely lightweight and effective torrent box that you can control remotely. It works great on very modest hardware even with lots of traffic flowing.&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/0p3kt2JHsC-579.avif 579w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/0p3kt2JHsC-579.webp 579w&quot;&gt;&lt;img alt=&quot;container info&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/0p3kt2JHsC-579.jpeg&quot; width=&quot;579&quot; height=&quot;346&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;h2 id=&quot;first-spin-up-a-container&quot; tabindex=&quot;-1&quot;&gt;First, spin up a container. &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/pmx-qbit-wg-lxc/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/RQSkXuO37I-791.avif 791w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/RQSkXuO37I-791.webp 791w&quot;&gt;&lt;img alt=&quot;container creation&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/RQSkXuO37I-791.jpeg&quot; width=&quot;791&quot; height=&quot;387&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;Click on the local storage of one of your nodes, go to container templates, and click the Templates button. I am using the ubuntu 22.10-standard template, only 129mb.&lt;/p&gt;
&lt;p&gt;After downloading the template, right click your node and create the container. On the first page, make sure to uncheck ‘unprivileged container’ so that we will have full write access to the samba share. If you are storing files some other way, you can leave it unprivileged. (You can also achieve write access to cifs shares with an unprivileged container through user mapping if you so choose.)&lt;/p&gt;
&lt;p&gt;Select the ubuntu template on the next page. I went with the defaults for all the other options except 2 cpu cores and a static IP address.&lt;/p&gt;
&lt;h2 id=&quot;start-the-container&quot; tabindex=&quot;-1&quot;&gt;Start the container! &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/pmx-qbit-wg-lxc/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Now we can start the container and do some stuff.&lt;/p&gt;
&lt;p&gt;First, login with username root and the password you set during creation. Update everything with&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; update &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; upgrade &lt;span class=&quot;token parameter variable&quot;&gt;-y&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Then, we need to install a few things&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; wireguard wireguard-tools &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; qbittorrent-nox cifs-utils iftop&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Since we installed cifs-utils in the last step, let’s go ahead and mount the network share. Edit your fstab file:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;nano&lt;/span&gt; /etc/fstab&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;I have created a user on my NAS named qbit for this service and added it to the samba permissions. It only has access to a folder for downloads. My fstab looks kinda like this:&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/oxosvwo3TL-875.avif 875w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/oxosvwo3TL-875.webp 875w&quot;&gt;&lt;img alt=&quot;fstab config&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/oxosvwo3TL-875.jpeg&quot; width=&quot;875&quot; height=&quot;79&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ctrl + X&lt;/strong&gt; to save, then type &lt;strong&gt;reboot&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;The share should mount on reboot. If not, check for errors with &lt;strong&gt;journalctl -b&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;let-s-dig-a-wireguard-tunnel&quot; tabindex=&quot;-1&quot;&gt;Let’s dig a wireguard tunnel &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/pmx-qbit-wg-lxc/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Now you need to log into your VPN provider of choice and download your wireguard configuration. One easy way to do this would be to drop it on your NAS if you have connected one in the last step.&lt;/p&gt;
&lt;p&gt;Navigate to wherever you put that config file so we can move it to its final resting place. Below, mine is named wireguard-vpn.conf:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;mv&lt;/span&gt; wireguard-vpn.conf /etc/wireguard/wireguard-vpn.conf &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; /etc/wireguard &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Let’s see if that bad boy works:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;wg-quick up wireguard-vpn&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/qBkKeZntks-836.avif 836w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/qBkKeZntks-836.webp 836w&quot;&gt;&lt;img alt=&quot;wireguard output&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/qBkKeZntks-836.jpeg&quot; width=&quot;836&quot; height=&quot;333&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;If you connected successfully, typing &lt;strong&gt;ip addr show&lt;/strong&gt; will list a new tunnel interface at the bottom with your VPN IP!&lt;/p&gt;
&lt;p&gt;Now make it reconnect automatically on reboot:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;systemctl &lt;span class=&quot;token builtin class-name&quot;&gt;enable&lt;/span&gt; wg-quick@wireguard-vpn&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Reboot and hit it with another &lt;strong&gt;ip addr show&lt;/strong&gt; to make sure we’re still connected to the tunnel!&lt;/p&gt;
&lt;h2 id=&quot;enable-qbittorrent-nox&quot; tabindex=&quot;-1&quot;&gt;Enable qbittorrent-nox &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/pmx-qbit-wg-lxc/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;We’re on the home stretch! Now make a service that will start qbittorrent-nox automatically on boot:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;nano&lt;/span&gt; /etc/systemd/system/qbittorrent-nox.service&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;We’ll keep it super simple:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Unit&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Description&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;qBittorrent-nox &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Documentation&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;man:qbittorrent-nox&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Wants&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;network-online.target
&lt;span class=&quot;token assign-left variable&quot;&gt;After&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;network-online.target nss-lookup.target

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Service&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Type&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;exec
&lt;span class=&quot;token assign-left variable&quot;&gt;ExecStart&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/usr/bin/qbittorrent-nox

&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;Install&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;WantedBy&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;multi-user.target&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now enable it and reboot to see if it works:&lt;/p&gt;
&lt;pre class=&quot;language-bash&quot; tabindex=&quot;0&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;systemctl &lt;span class=&quot;token builtin class-name&quot;&gt;enable&lt;/span&gt; qbittorrent-nox &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; systemctl daemon-reload &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;reboot&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Did it work?? You can try it by opening your web browser and typing in the local IP of the machine followed by port 8080!&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/WX1esYhBMp-759.avif 759w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/WX1esYhBMp-759.webp 759w&quot;&gt;&lt;img alt=&quot;working qbit interface&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/WX1esYhBMp-759.jpeg&quot; width=&quot;759&quot; height=&quot;577&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;h2 id=&quot;bind-qbt-nox-to-wireguard-interface&quot; tabindex=&quot;-1&quot;&gt;Bind Qbt-nox to wireguard interface &lt;a class=&quot;header-anchor&quot; href=&quot;https://stinky.blog/blog/pmx-qbit-wg-lxc/&quot;&gt;#&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;Last step! Go to &lt;strong&gt;Tools -&amp;gt; Options -&amp;gt; Advanced&lt;/strong&gt; and set the client to ONLY use the wireguard tunnel that we have created. If your VPN provides you a static IP, you can optionally set the client to ONLY use this IP as well.&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/Ytfrprzav2-837.avif 837w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/Ytfrprzav2-837.webp 837w&quot;&gt;&lt;img alt=&quot;bind to wireguard&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/Ytfrprzav2-837.jpeg&quot; width=&quot;837&quot; height=&quot;969&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;Now set your download folder to your samba share in the Downloads tab.&lt;/p&gt;
&lt;p&gt;That’s it! Now you can log in through this web interface from now on. You never have to access the container directly again. Add torrents by copying and pasting the magnet links into the webui from your phone or any other device!&lt;/p&gt;
&lt;p&gt;Ensure that traffic is flowing through the wireguard tunnel as expected by running the &lt;strong&gt;iftop&lt;/strong&gt; utility we downloaded earlier.&lt;/p&gt;
</content>
	</entry>
	
	<entry>
		<title>e-waste resurrection</title>
		<link href="https://stinky.blog/blog/e-waste/e-waste-resurrection/"/>
		<updated>2022-12-01T00:00:00Z</updated>
		<id>https://stinky.blog/blog/e-waste/e-waste-resurrection/</id>
		<content type="html">&lt;p&gt;Building a homelab on the cheap means using what you have laying around–even if what you have laying around is a dead Dell Inspiron 3521 from a decade ago. This laptop has already lived several lives. It got the wife through college. Before that, it traveled with the mother-in-law for business. It was pretty bad even back then, with a bendy plastic shell, mushy keyboard, and a screen like a gas pump. It does have an ivybridge i3, though! A 17-watt, 2 core, 4 thread behemoth locked at 1.9ghz with no turbo option. It has vt-d support and some usb ports, so it will be perfect as a node in my cluster for light containers and VMs like my NAS and Wireguard tunnels.&lt;/p&gt;
&lt;p&gt;The only problem: it doesn’t boot. It doesn’t even beep!&lt;/p&gt;
&lt;p&gt;Of course the cmos battery had died after all these years. Changing the battery got it to post! but only once. I accidentally knocked the cmos battery back out while it was running and corrupted the bios. It was SUPER dead this time, the cpu fan would only spin a partial turn before giving up.&lt;/p&gt;
&lt;p&gt;But never fear! Fixing a corrupted bios is pretty simple. The only two tools required are another working computer and a ch341a programmer (about $10 on Amazon) like this:&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/sXSKRFU8_o-400.avif 400w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/sXSKRFU8_o-400.webp 400w&quot;&gt;&lt;img alt=&quot;CH341a programmer&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/sXSKRFU8_o-400.jpeg&quot; width=&quot;400&quot; height=&quot;396&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;I found a dump of the original bios in a 2014 forum post on badcaps.net (thanks siddiq from ghana!).&lt;/p&gt;
&lt;p&gt;The ch341a comes with an 8-pin clip that connects directly to the pins on the bios chip. It is a little bit wobbly, and it will not read properly until it is making good contact with all 8 pins. You can make sure its working correctly by dumping the bios to a file, and then verifying the checksum against the file. The flashrom guide here was super easy to follow.&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/3jRVsZxj9J-400.avif 400w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/3jRVsZxj9J-400.webp 400w&quot;&gt;&lt;img alt=&quot;CH341a hooked up to bios chip and thinkpad&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/3jRVsZxj9J-400.jpeg&quot; width=&quot;400&quot; height=&quot;300&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;Flashrom autodetected the Winbond bios chip, I made a backup dump, and the checksum matched on the first try. I went ahead with flashrom -w on the dump I found online and… tadaaaa!&lt;/p&gt;
&lt;p&gt;&lt;picture&gt;&lt;source type=&quot;image/avif&quot; srcset=&quot;https://stinky.blog/img/feu1EXEmv2-400.avif 400w&quot;&gt;&lt;source type=&quot;image/webp&quot; srcset=&quot;https://stinky.blog/img/feu1EXEmv2-400.webp 400w&quot;&gt;&lt;img alt=&quot;e-waste resurrected!  ready to begin a proxmox cluster.&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot; src=&quot;https://stinky.blog/img/feu1EXEmv2-400.jpeg&quot; width=&quot;400&quot; height=&quot;300&quot;&gt;&lt;/picture&gt;&lt;/p&gt;
&lt;p&gt;It works! Now it is a fully functioning node in my Proxmox cluster. On to rescuing more e-waste for the homelab.&lt;/p&gt;
</content>
	</entry>
</feed>
